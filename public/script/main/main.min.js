"use strict";function LanguageService(a,b){function c(){var c=$.cookie(b.cookieLangKey);a.token?a.promise.then(function(a){a.user&&(f=e(a.user.lang))}):c&&(f=c)}function d(){return f}function e(a){return f=a,$.cookie(b.cookieLangKey,a,{expires:30,path:"/"}),d()}var f="en",g={init:c,getLanguage:d,setLanguage:e};return c(),g}function langFilter(a,b){var c="%%",d=function(a,b){for(var d=0;;){var e=a.indexOf(c);if(!(e>=0&&"undefined"!=typeof b[d]))break;a=a.replace(c,b[d]),d++}return a},e=function(c,e,f,g){var h=b.getLanguage();if(f=f||"en","se"===h&&(h="sv"),!c)return"";var i=c.split("|");if(4===i.length){var j={en:0,fi:1,sv:2,de:3};return d(i[j[h]],e)}if(h===f)return d(c,e);for(var k=angular.element.trim(c.toLowerCase()),l=0;l<a.length;l++)if(a[l][f].toLowerCase()===k)return d(a[l][h],e);return d(c,e)};return e}function Touch(a){var b=!1,c={elem:null,init:function(a){this.elem=a,c.galleryWidth=this.elem.parent().width(),c.width=c.getWidth(this.elem),c.maxWidth=c.width-c.galleryWidth},getWidth:function(){var a=0;return this.elem.find("li").each(function(){var b=angular.element(this);a+=parseInt(b.width())+parseInt(b.css("margin-right"))}),a},galleryWidth:0,width:0,maxWidth:0};this.drag={elem:null,initial:0,start:function(a){return!b&&(this.elem=angular.element(a.target).parents("ul:first"),angular.element(this.elem).parents(".gallery:first").addClass("drag"),c.init(this.elem),this.elem.stop(),void(this.initial=parseInt(this.elem.css("margin-left"))))},on:function(a){if(b)return!1;var d=parseInt(this.initial+a.gesture.deltaX);return!(d>=26)&&(!(Math.abs(d)>c.maxWidth+20)&&void this.elem.css("margin-left",d+"px"))},end:function(a){if(b)return!1;angular.element(this.elem).parents(".gallery:first").removeClass("drag");var d=parseInt(this.elem.css("margin-left"));d>0&&this.elem.animate({marginLeft:"0px"},200),Math.abs(d)>c.maxWidth&&this.elem.animate({marginLeft:"-"+(c.maxWidth-10)+"px"},200)}},this.flick=function(a,d){b=!0;var e=800,f=angular.element(a.target).parents("ul:first");if(c.init(f),c.width<c.galleryWidth)return!1;var g=parseInt(f.css("margin-left")),h=g+d*a.gesture.velocityX*200;h>0&&(h=0),Math.abs(h)>c.maxWidth&&(h=(c.maxWidth-10)*-1),f.animate({marginLeft:h+"px"},e,"easeOutQuint"),setTimeout(function(){b=!1},e)}}function MenuController(a,b,c,d,e,f,g,h,i,j,k){function l(){b.menuItems.push({id:"artview",title:"Art View",sref:"landing-artview"}),_.forEach(b.myArtCache,function(a){b.menuItems.push({id:a.id,title:a.title,sref:"landing-artcache"})}),b.menuItems.push({id:"now",title:"Now",sref:"landing-now"}),b.menuItems.push({id:"lastchance",title:"Last Chance",sref:"landing-lastchance"}),b.menuItems.push({id:"favorites",title:"Favorites",sref:"landing-favorites"})}function m(a){var c=_.findKey(b.menuItems,{sref:a});return c}angular.element(d);b.cities={active:a.$currentCity||null,open:!1,busy:!1,list:[],selected:!1,toggle:function(a){if(b.cities.busy)return!1;if(b.cities.busy=!0,b.cities.open="undefined"==typeof a?!b.cities.open:!!a,b.cities.open){var c=(k.getLanguage()||"").toLowerCase();"se"===c&&(c="sv");var d=function(a){for(var b=0;b<a.translations.length;b++)if(a.translations[b].lang===c)return a.translations[b].value};b.cities.list.forEach(function(a){a.cities.sort(function(a,b){var c=d(a),e=d(b);return c<e?-1:c>e?1:0})})}i(function(){b.cities.busy=!1},250)},select:function(c){a.$broadcast("$changeCity",c),b.cities.toggle(!1),b.cities.selected=!0}},b.$on("$changeCity",function(a,c,d){(d&&!b.cities.selected||!d)&&(b.cities.active=c)}),b.$on("bodyClick",function(){b.cities.open&&b.cities.toggle(!1)}),b.$on("$activateCities",function(a,c){b.cities.list.forEach(function(a){(a.cities||[]).forEach(function(a){a.hasEvents=(c||[]).indexOf(a.ascii)>=0})})});var n=function(){j.get("venues/cities").then(function(a){b.cities.list.length=0;var c=a.data||[];c.sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0}),c.forEach(function(a){var c=function(){for(var c=0;c<b.cities.list.length;c++)if(b.cities.list[c].code.toLowerCase()===a.country.code.toLowerCase())return c;return-1}();c<0&&(a.country.cities=[],c=b.cities.list.length,b.cities.list.push(a.country)),b.cities.list[c].cities.push(a)}),b.cities.selected=!1})};n(),a.$on("updateCities",function(){n()}),b.Authentication=h,b.$state=null,b.$stateParams=null,b.$previous=null,b.$previousParams=null;var o="landing-";b.landingPages=["artview","artcache","now","lastchance","favorites"],b.artCache=e.artCache,b.myArtCache=angular.copy(b.artCache),b.menuItems=[],b.menuActive=0,l(),b.hidePrev=!1,b.hideNext=!1,b.gotoPageForIndex=function(a){c.go(b.menuItems[a].sref)};var p=function(){var a=["artview"],c=["now","lastchance","favorites"];b.landingPages=[];for(var d in a)b.landingPages.push(a[d]);for(var e in b.myArtCache)b.landingPages.push("artcache");for(var f in c)b.landingPages.push(c[f])},q=function(){h.swear().promise.then(function(){if(h.user&&h.user.hiddenArtCache){b.myArtCache=[];var a=[];for(var c in h.user.hiddenArtCache){var d=h.user.hiddenArtCache[c];d._id||d;a.push(d)}for(var e in b.artCache)a.indexOf(b.artCache[e]._id)<0&&b.myArtCache.push(b.artCache[e])}else b.myArtCache=angular.copy(b.artCache);p()})};a.$on("userChanged",function(){q()}),q(),b.activeLanding="",b.active=function(a){if(!b.$state)return!1;var c=[];if(["main","landing","mobile"].indexOf(a)>=0)for(var d in b.landingPages)c.push(o+b.landingPages[d]);return["main"].indexOf(a)>=0&&c.push("404"),["user"].indexOf(a)>=0&&(c=["venue","exhibition","artist"]),["authenticated"].indexOf(a)>=0&&(c=["profile","venue-create","venue-edit","exhibition-create","exhibition-edit","artcache"]),c.indexOf(b.$state.name)>=0};var r=function(a){b.menuActive=m(a.name),"mobile"===e.device&&"fi"===e.lang&&"landing-artview"===a.name?(b.hidePrev=!0,b.hideNext=!0):(b.hidePrev=!1,b.hideNext=!1)};b.goHome=function(){if(a.gotoPage){var d="landing";if(c.current&&c.current.name.substr(0,d.length)===d){var e=0;for(var f in b.menuItems)if("landing-now"===b.menuItems[f].sref){e=f;break}a.gotoPage(e)}}},b.$on("stateChanged",function(a,c){if(b.$state=c.toState,b.$stateParams=c.toParams,b.$previous=c.fromState,b.$previousParams=c.fromParams,r(b.$state),b.swiperNoSwiping)return!1;if(!f.filter(b.$state,b.$stateParams))return!1;c.toState.name.substr(o.length);d.is(":hidden")&&d.show(200)}),b.$on("deviceChanged",function(){c.current&&r(c.current)}),b.initLanding=function(){c.current&&r(c.current)},b.back=function(){return c.go("landing-now")}}function SplashController(a,b,c,d,e,f,g,h){b.languages=["en","fi","se","de"],a.hasFooter=!1,b.activeLang=function(a){return a===h.getLanguage()},b.selectLang=function(a){h.setLanguage(a),e.token?f.put("me",{user:{lang:a}}).then(function(a){d.go("authentication")}):g.post("/lang",{lang:a}).then(function(a){d.go("authentication")})}}function AuthenticationController(a,b,c,d,e,f,g,h,i,j){a.auth=g,a.next=function(){e.next?b.url(decodeURIComponent((e.next+"").replace(/\+/g,"%20"))):d.go("landing-now")};var k=200;a.form={guest:{input:{},show:!1,response:{success:!0,message:""},submit:function(){d.go("landing-now")}},login:{element:angular.element(f).find(".form.login:first"),input:{},show:!1,busy:!1,response:{success:!0,message:""},toggle:function(b,c){var d=this;"undefined"==typeof b&&(b=d.show,a.form.join.toggle(!0)),b?(d.element.removeClass("toggled"),d.element.find(".submit:first").hide(k,function(){d.show=!1,d.element.removeClass("show toggling")})):(d.element.addClass("toggled"),d.element.find(".submit:first").show(k,function(){d.show=!0,d.element.addClass("show")}))},submit:function(b,d,e){var f=this;return!this.busy&&(this.busy=!0,this.response.message="",b||(b=this.input.email),d||(d=this.input.password),c.post("/api/authenticate",{email:b,password:d}).success(function(b){b.success?(g.token=b.token,h.token=b.token,e||(a.form.login.response.success=!0,a.form.login.response.message="Login successful"),b.lang&&j.setLanguage(b.lang),g.swear(),a.next()):e||(a.form.login.response=b),f.busy=!1}).error(function(b){e||(a.form.login.response.success=!1,a.form.login.response.message="Login error"),f.busy=!1}),!1)}},join:{element:angular.element(f).find(".form.join:first"),input:{name:{},type:"artlover",genres:[]},show:!1,busy:!1,typeActive:function(a){return this.input.type===a},genreActive:function(a){return this.input.genres.indexOf(a)>=0},types:[{name:"artlover",title:"art lover"},{name:"artist",title:"artist"},{name:"organizer",title:"event organizer",hint:"eg gallery, museum, art festival"}],genres:i,response:{success:!0,message:""},toggle:function(b,c){var d=this;"undefined"==typeof b&&(b=d.show,a.form.login.toggle(!0)),b?(d.element.removeClass("toggled"),d.element.find(".submit:first").hide(k,function(){d.show=!1,d.element.removeClass("show toggling")})):(d.element.addClass("toggled"),d.element.find(".submit:first").show(k,function(){d.show=!0,d.element.addClass("show")}))},submit:function(){var b=this;if(this.busy)return!1;this.busy=!0,this.response.message="";var d={email:{value:this.input.email,title:"Email address"},password:{value:this.input.password,title:"Password"}};"organizer"!==this.input.type&&(d.firstName={value:this.input.name.first,title:"First name"},d.lastName={value:this.input.name.last,title:"Last name"});for(var e in d)if(d[e].value=angular.element.trim(d[e].value),!d[e].value)return a.form.join.response.success=!1,a.form.join.response.message=d[e].title+" is required",!1;return this.input.password!==this.input.confirm?(a.form.join.response.success=!1,a.form.join.response.message="Password does not match",!1):(c.post("/api/register",this.input).success(function(c){c.success?a.form.login.submit(d.email.value,d.password.value,!0):a.form.join.response=c,b.busy=!1}).error(function(c){a.form.join.response.success=!1,a.form.join.response.message="Register error",b.busy=!1}),!1)}}};var l=e.action,m=e.message;l&&(a.form[l].toggle(),m&&(a.form[l].response.success=!1,a.form[l].response.message=m))}function SettingsController(a,b,c,d,e,f,g,h,i,j,k,l){d.admin=!!a.admin,d.goAdmin=function(){a.location="/admin/"};var m=200;d.user={name:{},lang:l.getLanguage()},d.changeLang=function(b){d.user.lang=b,a.lang=b},d.userLoggedIn=function(){return h.token},d.genres=k,d.genreActive=function(a){return d.user.genres&&d.user.genres.indexOf(a)>=0},d.addLink=function(){d.user.links.push({title:"",url:""})},d.removeLink=function(a){d.user.links.splice(a,1)},d.email={old:"","new":"",code:"",message:"",status:"",busy:!1,update:function(a,b){if(this.busy)return!1;var c=this;this.status="error",this.message="",i.put("me/email",{email:a,code:b}).then(function(a){c.status=a.data.success?"success":"error",c.message=a.data.message,c.busy=!1,a.data.success&&e(function(){d.email.old=a.data.message,d.email["new"]=a.data.message,c.message="Email successfully changed"},1)})},change:function(){if(this.busy)return!1;var a=this;return this.status="error",this.message="",this.old!==this["new"]&&(this.busy=!0,this.status="success",this.message="Processing request...",void i.put("me/email",{email:a["new"]}).then(function(b){a.status=b.data.success?"success":"error",a.message=b.data.message,a.busy=!1}))}},d.username={value:"",message:"",status:"",busy:!1,change:function(){if(this.busy||d.user&&d.username.value===d.user.username)return!1;var a=this;return this.status="error",this.message="",d.username.value?(this.busy=!0,void i.put("me/username",{username:d.username.value}).then(function(b){a.status=b.data.success?"success":"error",a.message=b.data.message,b.data.success&&(d.user.username=d.username.value.toLowerCase()),a.busy=!1})):(this.message="Type username",!1)}},d.password={old:"","new":"",confirm:"",message:"",status:"",busy:!1,change:function(){if(this.busy)return!1;var a=this;return this.status="error",this.message="",this.old&&this["new"]?this["new"]!==this.confirm?(this.message="Password does not match",!1):(this.busy=!0,void i.put("me/password",{old:this.old,"new":this["new"]}).then(function(b){a.status=b.data.success?"success":"error",a.message=b.data.message,b.data.success&&angular.element(c).find(".password input").val(""),a.busy=!1})):(this.message="All fields are required",!1)}},d.social={types:[{name:"facebook",title:"Facebook"},{name:"google",title:"Google"}],linked:function(a){if(!d.user.social||!d.user.social.length)return!1;for(var b in d.user.social)if(d.user.social[b].name===a)return!0;return!1},unlink:function(a){i["delete"]("me/social/"+a).then(function(a){d.user.social=a.data})}},d.notification={active:!1,toggle:function(a){this.active=a,d.user&&(d.user.notifications=a?"on":"off")}},d.language={list:[{name:"en",title:"English"},{name:"fi",title:"Finnish"},{name:"se",title:"Swedish"},{name:"de",title:"Deutch"}]},d.profileType={list:[{name:"artlover",title:"Art lover"},{name:"artist",title:"Artist"},{name:"organizer",title:"Event organizer"}]},d.profileMessage="";var n,o=function(){if(l.setLanguage(d.user.lang),!h.token)return!1;d.profileMessage="Saving";var a={name:{first:d.user.name.first||"",last:d.user.name.last||""},description:d.user.description,genres:d.user.genres,links:d.user.links,lang:d.user.lang,profileType:d.user.profileType,notifications:d.user.notifications};i.put("me",{user:a}).then(function(a){d.profileMessage="Saved"})},p=1e3,q=function(){setTimeout(function(){d.$watch("user",function(a,b){a!==b&&(n&&e.cancel(n),n=e(function(){o()},p))},!0)},1e3)};d.toggleList=function(a){var b=a.find("ul:first");return!b.is(":animated")&&void(a.hasClass("open")?b.hide(m,function(){a.removeClass("open")}):b.show(m,function(){a.addClass("open")}))},d.toggleSetting=function(a){var b=angular.element(a.currentTarget);d.toggleList(b.parent())},d.logout=function(){i["delete"]("authenticate/logout",{}).then(function(a){h.token=null,g.go("authentication")})},d.getLoggedInUser=function(a){return h.token?void i.get("me").then(function(b){d.user=b.data||null,d.username.value=d.user?d.user.username||"":"",d.email.old=d.email["new"]=d.user.email,d.notification.active=!!d.user&&"on"===d.user.notifications,!d.user||d.user.links&&0!==d.user.links.length||(d.user.links=[{title:"",url:""}]),d.user.photo&&(d.photo.source="/"+d.user.photo.source),a(d.user)}):(a(d.user),!1)},d.getLoggedInUser(function(a){q()}),d.confirmClose=!1,d.closeAccount=function(){i["delete"]("me").then(function(b){a.location="/authentication"})},d.photo={files:[],source:"",upload:function(a){return!(!a||!a.length)&&void j.upload({url:"/api/upload",fields:{},file:a[0]}).progress(function(a){}).success(function(a,b,c,e){d.photo.source="/"+a.file.full,i.put("me/photo",{source:d.photo.source.substr(1)}).then(function(a){})})}},d.back=function(){return g.go("landing-now")};var r=b.search();r.email&&r.code&&d.userLoggedIn()&&(d.toggleList(c.find("li.email:first")),d.email.update(r.email,r.code))}function ArtViewController(a,b,c,d,e,f){a.arts=[],a.current=0,a.limit=12;var g=function(){var a=angular.element("#modal .wrap:first"),b=angular.element(e).height(),c=a.height();a.css("top",b/2-c/2+"px")};a.modal={show:!1,open:function(){angular.element("body").addClass("enclosed"),this.show=!0,f(function(){g()},50)},close:function(){angular.element("body").removeClass("enclosed"),this.show=!1},toggle:function(){return this.show?this.close():this.open()}},a.$on("$destroy",function(){a.modal.close()}),a.preview={index:0,art:null,show:function(b){if(!a.arts.length)return!1;if(!a.arts[b])return!1;this.art=a.arts[b];var c=angular.element("#preview");c.addClass("show"),a.initialized&&a.modal.open(),this.index=b},previous:function(){this.show(this.index-1)},next:function(){this.show(this.index+1)}},a.initialized=!1,a.initialize=function(){a.preview.show(0),a.initialized=!0},a.ended=!1,a.loaded=[];var h=function(){var b=[];return(a.arts||[]).forEach(function(a){b.push(a.photo.photo.id)}),b},i=function(a,b){for(var c in a.photos)if(a.photos[c].photo===b.id)return a.photos[c].photo=b,a.photos[c];return null};a.loadArts=function(b){return!(a.loaded.indexOf(a.current)>=0)&&(a.loaded.push(a.current),void d.post("galleries",{start:a.current,limit:a.limit,exclude:h().join(",")}).then(function(c){var d=c.data.data;if(d&&d.length||(a.ended=!0),d.length)for(var e in d){var f=d[e],g=i(f.gallery,f);g&&a.arts.push({exhibition:f.gallery.exhibition,photo:g})}a.initialized||a.initialize(),a.current+=a.limit,a.limit=6,b&&b()}))},angular.element(e).on("resize",function(){g()}),a.brickHeight=function(a){var b=0;switch(device){case"extraLargeDesktop":b=304;break;case"largeDesktop":b=263.993;break;case"desktop":b=202;break;case"tablet":b=162.5;break;case"mobile":b=91.3125}var c=a.width/a.height;return b/c},a.reconstruct=function(){f(function(){a.arts=angular.copy(a.arts)},1)},a.$on("deviceChanged",function(){a.reconstruct()})}function ArtCacheController(a,b,c,d,e,f,g,h,i){b.admin=!!a.admin,b.exhibition={},b.commentSource="",b.modal={id:null,index:"id",items:[],set:function(a,c,d){h(function(){b.modal.items=a,b.modal.index=c,b.modal.id=d},1)}},b.touch=new Touch,b.map={options:e,center:{latitude:60.17332440000001,longitude:24.9410248},zoom:15,marker:{icon:{url:a.location.origin+root+"/images/marker.png"},options:{title:"",labelContent:"",labelClass:"markerLabel",labelAnchor:"150 46"}},desktopControl:{},mobileControl:{}},g.setCenter("desktop",b.map.center).setCenter("mobile",b.map.center).initialize("desktop",b.map.desktopControl).initialize("mobile",b.map.mobileControl),b.loadExhibition=function(c){var e=a.artCache[0];i.promise.then(function(){if(i.user&&i.user.hiddenArtCache)for(var a in i.user.hiddenArtCache){var b=i.user.hiddenArtCache[a];if(e._id===(b._id||b)){d.go("landing-now");break}}}),e.venue&&(b.map.center.latitude=e.venue.address.coordinates.latitude,b.map.center.longitude=e.venue.address.coordinates.longitude,g.setCenter("desktop",e.venue.address.coordinates),g.setCenter("mobile",e.venue.address.coordinates),b.commentSource="artcache/"+e._id+"/comments",b.map.marker.options.title=e.venue.name,b.map.marker.options.labelContent=e.venue.name,b.exhibition={photos:e.gallery.photos,date:{start:e.startDate,end:e.endDate},name:e.name,permalink:e.permalink,secondaryName:e.secondaryName,artists:e.artists,open:"Open today from 10 to 16",openingHours:e.openingHours,specialHours:e.specialHours,openByAppointment:!!e.openByAppointment,admissionFee:e.admissionFee,description:e.description,publications:[{publisher:"Helsingin Sanomat",authors:["Timo Valjakka"],date:"2014-05-20"},{publisher:"Edit Media",authors:["Pekka Putkonen"],date:"2015-05-25"}],links:e.links,genre:e.genres,venue:{name:e.venue.name,permalink:e.venue.permalink,address:{city:e.venue.address.city,lang:e.venue.address.lang,full:e.venue.address.full,distance:"100m",coordinates:e.venue.address.coordinates}},comments:[{date:"2015-01-08",content:"On Saturday 17th John Philip will give an introduction to the exhibition and tell about the creating process. Be there!",author:{name:"Mari M.",website:""}},{date:"2015-01-06",content:"Once again a great exhibition at Forum Box! Highly recommended!",author:{name:"Mika P.",website:""}},{date:"2015-01-05",content:"Thanks John Philip and Mari!",author:{name:"Paula K.",website:""}}]})},b.loadExhibition()}function NowController(a,b,c,d,e,f,g){b.auth=d,b.exhibitions=[],b.current=0,b.limit=10,b.favorite=function(a){var b="events/"+a.permalink+"/favorite",c=a.favorited?e["delete"](b):e.post(b);c.then(function(b){b.data.success&&(a.favorited=!a.favorited)})},b.recommend=function(a){var b="events/"+a.permalink+"/recommend",c=a.recommended?e["delete"](b):e.post(b);c.then(function(b){b.data.success&&(a.recommended=!a.recommended)})},b.ended=!1,b.busy=!1,b.loaded=[];var h=!1,i=!1,j="";g.promise.then(function(){h=!0,j=g.current.longitude+","+g.current.latitude,i&&b.loadExhibitions()}),b.restart=function(){return b.loaded.length=0,b.ended=!1,b.exhibitions=[],b.current=0,b.loadExhibitions()},b.loadExhibitions=function(){if(i=!0,!h||!a.$currentCity)return!1;if(b.loaded.indexOf(b.current)>=0)return!1;b.loaded.push(b.current);var c={start:b.current,limit:b.limit,landing:"now",sort:"-recommended",near:j,city:a.$currentCity.lcase};b.busy=!0,e.get("events",c).then(function(c){var d=c.data;d.data.length||(b.ended=!0),d.cities&&a.$broadcast("$activateCities",d.cities||[]);for(var e=0;e<d.data.length;e++){var f=d.data[e],g=[];for(var h in f.artists)g.push(f.artists[h].user?f.artists[h].user.fullname:f.artists[h].nonUser.fullname);b.exhibitions.push({id:f._id,name:f.name,permalink:f.permalink,artists:g,date:{start:f.startDate,end:f.endDate},address:{full:f.venue.address.line1||"",coordinates:f.venue.address.coordinates||{},distance:"250m"},venue:f.venue,image:{dimensions:{width:f.gallery.photos[0].photo.width,height:f.gallery.photos[0].photo.height},thumb:"",medium:root+f.gallery.photos[0].photo.source,large:""},open:"Open today from 12 to 18",openingHours:f.openingHours,specialHours:f.specialHours,favorited:f.favorite,recommended:f.recommend}),b.current++}b.limit=3,b.busy=!1})},b.brickHeight=function(a){var c=a.dimensions.width/a.dimensions.height;return parseInt(b.brickWidth()/c)},b.$on("$changeCity",b.restart)}function VenueController(a,b,c,d,e,f,g,h,i,j){d.authentication=j,d.venue={},d.commentSource="",d.touch=new Touch,d.map={options:g,center:{latitude:60.17332440000001,longitude:24.9410248},zoom:15,marker:{icon:{url:b.location.origin+root+"/images/marker.png"},options:{title:"",labelContent:"",labelClass:"markerLabel",labelAnchor:"150 46"}},control:{}},d.modal={id:null,index:"id",items:[],set:function(a,b,e){c(function(){d.modal.items=a,d.modal.index=b,d.modal.id=e},1)}},d.share={active:!1,show:function(){d.share.active=!0}},d.menu={back:function(){return f.go("landing-now")},others:function(){f.go("report",{url:f.href(f.current.name,f.params)})},recommended:!1,favorited:!1,recommend:function(){var a="venues/"+f.params.permalink+"/recommend",b=d.menu.recommended?h["delete"](a):h.post(a);b.then(function(a){a.data.success&&(d.menu.recommended=!d.menu.recommended)})},favorite:function(){var a="venues/"+f.params.permalink+"/favorite",b=d.menu.favorited?h["delete"](a):h.post(a);b.then(function(a){a.data.success&&(d.menu.favorited=!d.menu.favorited)})},share:function(){},map:function(){f.go("map",{venue:d.venue.permalink})}},i.setCenter("map",d.map.center).initialize("map",d.map.control),d.showAll=!1,d.showExhibition=function(a){return d.venue.exhibitions[a].active=!!d.venue.exhibitions[a].active,d.venue.exhibitions[a].active!==d.showAll},d.loadVenue=function(a){h.get("venues/"+f.params.permalink).then(function(a){var b=a.data;if(!b._id||!b.id)return f.go("404"),!1;d.commentSource="venues/"+b.permalink+"/comments",d.map.center.latitude=b.address.coordinates.latitude,d.map.center.longitude=b.address.coordinates.longitude,i.setCenter("map",b.address.coordinates),d.menu.favorited=b.favorite,d.menu.recommended=b.recommend,d.map.marker.options.title=b.name,d.map.marker.options.labelContent=b.name,d.venue={name:b.name,venueTypes:b.venueTypes.length?b.venueTypes:[b.venueType],permalink:b.permalink,photos:b.album&&b.album.photos?b.album.photos:[],address:{full:b.address.full,line1:b.address.line1,city:b.address.city,lang:b.address.lang,distance:"100m",coordinates:b.address.coordinates},owned:b.owned,open:"Open today from 10 to 16",description:b.description,openingHours:b.openingHours,openByAppointment:!!b.openByAppointment,links:b.links,contacts:b.contacts,admissionFee:b.admissionFee,websites:b.websites,exhibitions:b.exhibitions,guestbook:[]};for(var c=["gallery","museum","public","other"],e=d.venue.venueTypes.length-1;e>=0;e--)c.indexOf(d.venue.venueTypes[e])>=0&&d.venue.venueTypes.splice(e,1)})["catch"](function(){f.go("404")})},d.loadVenue()}function ExhibitionController(a,b,c,d,e,f,g,h,i,j,k){c.exhibition={},c.commentSource="",c.location=i,c.modal={id:null,index:"id",items:[],set:function(a,b,d){h(function(){c.modal.items=a,c.modal.index=b,c.modal.id=d},1)}},c.share={active:!1,show:function(){c.share.active=!0}},c.menu={back:function(){return e.go("landing-now")},others:function(){e.go("report",{url:e.href(e.current.name,e.params)})},recommended:!1,favorited:!1,recommend:function(){var a="events/"+e.params.permalink+"/recommend",b=c.menu.recommended?d["delete"](a):d.post(a);b.then(function(a){a.data.success&&(c.menu.recommended=!c.menu.recommended)})},favorite:function(){var a="events/"+e.params.permalink+"/favorite",b=c.menu.favorited?d["delete"](a):d.post(a);b.then(function(a){a.data.success&&(c.menu.favorited=!c.menu.favorited)})},share:function(){},map:function(){e.go("map",{event:c.exhibition.permalink})}},c.touch=new Touch,c.map={options:f,center:{latitude:60.17332440000001,longitude:24.9410248},zoom:15,marker:{icon:{url:b.location.origin+root+"/images/marker.png"},options:{title:"",labelContent:"",labelClass:"markerLabel",labelAnchor:"150 46"}},desktopControl:{},mobileControl:{}},g.setCenter("desktop",c.map.center).setCenter("mobile",c.map.center).initialize("desktop",c.map.desktopControl).initialize("mobile",c.map.mobileControl),c.loadExhibition=function(a){d.get("events/"+e.params.permalink).then(function(a){var b=a.data;return b._id&&b.id?(c.map.center.latitude=b.venue.address.coordinates.latitude,c.map.center.longitude=b.venue.address.coordinates.longitude,g.setCenter("desktop",b.venue.address.coordinates),g.setCenter("mobile",b.venue.address.coordinates),c.commentSource="events/"+b.permalink+"/comments",c.menu.favorited=b.favorite,c.menu.recommended=b.recommend,c.map.marker.options.title=b.venue.name,c.map.marker.options.labelContent=b.venue.name,void(c.exhibition={permalink:b.permalink,photos:b.gallery.photos,date:{start:b.startDate,end:b.endDate},owned:b.owned,name:b.name,secondaryName:b.secondaryName,artists:b.artists,open:"Open today from 10 to 16",openingHours:b.openingHours,specialHours:b.specialHours,openByAppointment:!!b.openByAppointment,admissionFee:b.admissionFee,description:b.description,publications:[{publisher:"Helsingin Sanomat",authors:["Timo Valjakka"],date:"2014-05-20"},{publisher:"Edit Media",authors:["Pekka Putkonen"],date:"2015-05-25"}],links:b.links,genre:b.genres,venue:{name:b.venue.name,permalink:b.venue.permalink,address:{line1:b.venue.address.line1,city:b.venue.address.city,lang:b.venue.address.lang,full:b.venue.address.full,distance:"100m",coordinates:b.venue.address.coordinates}},comments:[{date:"2015-01-08",content:"On Saturday 17th John Philip will give an introduction to the exhibition and tell about the creating process. Be there!",author:{name:"Mari M.",website:""}},{date:"2015-01-06",content:"Once again a great exhibition at Forum Box! Highly recommended!",author:{name:"Mika P.",website:""}},{date:"2015-01-05",content:"Thanks John Philip and Mari!",author:{name:"Paula K.",website:""}}]})):(e.go("404"),!1)})["catch"](function(){e.go("404")})},c.loadExhibition()}function CreateExhibitionController(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.today=j(),a.admin=g.admin,a.blurs=[],a.blur=function(b){a.blurred(b)||a.blurs.push(b)},a.blurred=function(b){return a.blurs.indexOf(b)>=0},a.redirect=null,angular.element("tags-input").each(function(){var b=angular.element(this),c=b.attr("name");b.on("blur","input:text",function(){a.blur(c)})}),angular.element("div.uploaded:first").on("blur",".photo tags-input input:text",function(){var b=angular.element(this),c=parseInt(b.parents(".photo:first").attr("index"));a.photos[c].blurred=!0});var o=[{day:0,hours:[{start:"",end:""}]},{day:1,hours:[{start:"1100",end:"1700"}]},{day:2,hours:[{start:"1100",end:"1700"}]},{day:3,hours:[{start:"1100",end:"1700"}]},{day:4,hours:[{start:"1100",end:"1700"}]},{day:5,hours:[{start:"1200",end:"1600"}]},{day:6,hours:[{start:"1200",end:"1600"}]}];a.artCache={enabled:!1,choices:[{active:!0,title:"enabled"},{active:!1,title:"disabled"}],active:function(b){return b.active.toString()===a.artCache.enabled.toString()},titles:{}};var p=[{date:"",startHour:"",endHour:""}],q=function(b){for(var c in a.photos)if(a.photos[c].id===b)return c;return-1},r=angular.element;a.removePhoto=function(b){var c=q(b);c>=0&&r("#photo-"+b).fadeTo(200,.01,function(){a.photos.splice(c,1),r(".uploaded .photo").css("opacity",1),a.$$phase||a.$apply()})};a.files=[],a.photos=[];var s=a.photos.length;a.upload=function(b){for(var c in b){var d=b[c];s++,d.uploadId=s,a.photos.push({id:s,loading:!0,full:"",source:""}),h.upload({url:"/api/upload",fields:{},file:d}).progress(function(a){}).success(function(b,c,d,e){var f=q(e.file.uploadId);f>=0&&(a.photos[f].source=b.file.full,a.photos[f].blurred=!1,r("#photo-"+e.file.uploadId).removeClass("loading"))})}},a.days=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],a.hours=[""];for(var t=0;t<=23;t++){var u=t?(t<10?"0":"")+t:"00";a.hours.push(u+"00"),a.hours.push(u+"30")}a.hours.push("2359"),a.addHoursRange=function(b){if(a.singleDay())return!1;var c=a.form.input.openingHours[b].hours[a.form.input.openingHours[b].hours.length-1];a.form.input.openingHours[b].hours.push({start:c.end,end:c.end})},a.removeHoursRange=function(b,c){if(a.singleDay())return!1;var d=a.form.input.openingHours[b].hours.length<=1;a.form.input.openingHours[b].hours.splice(c,1),d&&a.form.input.openingHours[b].hours.push({start:"",end:""})},a.closeOn=function(b){a.form.input.openingHours[b].hours=[{start:"",end:""}]},a.isClosedOn=function(b){var c=a.form.input.openingHours[b];return 1===c.hours.length&&!c.hours[0].start&&!c.hours[0].end},a.openWholeDayOn=function(b){a.form.input.openingHours[b].hours=[{start:"0000",end:"2359"}]},a.isOpenWholeDayOn=function(b){var c=a.form.input.openingHours[b];return 1===c.hours.length&&"0000"===c.hours[0].start&&"2359"===c.hours[0].end},a.toggleAppointment=function(){a.form.input.openByAppointment=!a.form.input.openByAppointment,a.toggleDates(a.form.input.openByAppointment)},a.addSpecial=function(){a.form.input.specialHours.push({date:"",startHour:"",endHour:""})},a.removeSpecial=function(b){var c=a.form.input.specialHours.length<=1;a.form.input.specialHours.splice(b,1),c&&a.addSpecial()},a.toggleDates=function(a){a?angular.element(".day.group.regular, .day.group.special").each(function(){angular.element(this).find("input, select, textarea").each(function(){angular.element(this).attr("disabled","disabled").addClass("disabled")})}):angular.element(".day.group.regular, .day.group.special").each(function(){angular.element(this).find("input, select, textarea").each(function(){angular.element(this).removeAttr("disabled").removeClass("disabled")})})},a.hasOneSpecialDate=function(){for(var b in a.form.input.specialHours)if(a.form.input.specialHours[b]&&a.form.input.specialHours[b].date&&a.form.input.specialHours[b].startHour&&a.form.input.specialHours[b].endHour)return!0;return!1},a.hasSpecial=function(){return a.hasOneSpecialDate()},a.$watch("hasSpecial()",function(b,c){b!==c&&a.toggleDates(b)}),a.artists={list:[],loaded:!1,deferred:n.defer(),load:function(){return a.artists.loaded?a.artists.deferred.promise:(i.get("artists/list").then(function(b){a.artists.list=b.data.data||[],a.artists.loaded=!0,a.artists.deferred.resolve(a.artists)}),a.artists.deferred.promise)},query:function(b){var c=n.defer();return b=b.toLowerCase(),a.artists.load().then(function(a){var d=[];a.list.forEach(function(a){a.name.full.toLowerCase().indexOf(b)>=0&&d.push(a)}),c.resolve(d)}),c.promise}},a.artists.load(),a.form={genreActive:function(a){return this.input.genres.indexOf(a)>=0},genres:m,loadArtists:function(a){return i.get("artists",{q:a,"return":"data"})},tagCounter:0,tagAdded:function(b){a.form.tagCounter++,b._id||(b._id=a.form.tagCounter,b.guest=!0)},loadVenues:function(a){return i.get("venues",{q:a,"return":"data"})},dates:{start:a.today.clone().toDate(),end:a.today.clone().add(5,"days").toDate()},input:{genres:[],artists:[],venue:[],openingHours:o.slice(0),specialHours:p.slice(0),links:[{title:"",url:""}]},response:{},submit:function(){var b=this;if(_.size(a.photos)>0){var c=!1;if(angular.forEach(a.photos,function(a){0===_.size(a.nonUserArtists)&&(c=!0)}),c===!0)return this.response.message="Please select the artist/s for the photos",!1}b.input.photos=a.photos,this.response.message="",i.post("events",b.input).then(function(c){
b.response=c.data,c.data.success&&(a.redirect=["exhibition",{permalink:c.data.data.permalink}])})}},f.venue&&i.get("venues/"+f.venue).then(function(b){a.form.input.venue=[b.data],a.prefillEvent()});var v=b.find("tags-input:first");a.$watch(function(){return v.attr("class")},function(a,b){v.hasClass("ng-invalid")&&c.$broadcast("openPopup","venueDoesNotExist")}),a.focusVenue=function(){b.find("tags-input:first input:last").focus().select()};var w=b.find(".input.dates [date-range]:first");a.$on("setDate",function(a,b){if("object"==typeof a.targetScope.$parent.start&&"object"==typeof a.targetScope.$parent.end&&a.targetScope.date&&(a.targetScope.$$prevSibling||a.targetScope.$$nextSibling)&&!a.targetScope.$$prevSibling&&a.targetScope.$$nextSibling){var c=a.targetScope.date,d=a.targetScope.$$nextSibling.date,e=c.getMonth(),f=d.getMonth();e!==f&&(d.setYear(c.getFullYear()),d.setMonth(e))}}),k.put("templates/daterange.html",'<div class="date-range-wrap"><div class="date-picker-wrap"><h4>{{ \'Opening\' | lang }}</h4><div date-picker="start" ng-disabled="disableDatePickers" class="date-picker start" date after="start" before="end" min-view="date" max-view="date"></div></div><div class="date-picker-wrap"><h4>{{ \'Closing\' | lang }}</h4><div date-picker="end" ng-disabled="disableDatePickers" class="date-picker end" date after="start" before="end" min-view="date" max-view="date"></div></div></div>'),a.showDatepicker=function(){w.fadeIn(200)},a.hideDatepicker=function(){w.fadeOut(200),a.specialDateIndex=-1},a.$watchCollection("[form.dates.start, form.dates.end]",function(b,c){var d=j(a.form.dates.start),e=j(a.form.dates.end);a.form.input.dates=d.format("DD.MM.YYYY")+"-"+e.format("DD.MM.YYYY")}),a.addLink=function(){a.form.input.links.push({title:"",url:""})},a.removeLink=function(b){a.form.input.links.splice(b,1)},a.prefillEvent=function(){a.form.input.admissionFee=a.form.input.venue[0].admissionFee,a.form.input.openingHours=angular.copy(a.form.input.venue[0].openingHours)},b.on("keydown",'input.date, .input.dates:first input[name="dates"]',function(){return!1}),a.specialDateIndex=-1,a.specialDateFocused=function(b){a.specialDateIndex=b},a.singleDay=function(){return a.form.dates.start.toString()===a.form.dates.end.toString()},a.$watch("singleDay()",function(b,c){b!==c&&a.toggleDates(b)})}function ArtistController(a,b,c,d,e,f,g,h,i){b.auth=g,b.owner=function(){return b.auth&&b.auth.user&&b.auth.user._id&&b.artist&&b.artist.id&&b.auth.user._id===b.artist.id},b.photos=[];var j=b.photos.length;b.upload=function(a){for(var c in a){var d=a[c];j++,d.uploadId=j,b.photos.unshift({id:j,loading:!0,full:"",source:""}),h.upload({url:"/api/upload",fields:{},file:d}).progress(function(a){}).success(function(a,c,d,e){a.success?f.post("/me/photo",{source:a.file.full}).then(function(a){var c=-1;for(var d in b.photos){if(!b.photos[d].loading)break;c=d}c>=0&&(a.data&&a.data._id?b.photos[c]=a.data:b.photos.splice(0,1))}):b.photos.splice(0,1)})}},b.removePhoto=function(a){confirm("Are you sure you want to remove this photo? Press OK to continue")&&f["delete"]("me/photo/"+(a._id||a.id)).then(function(c){if(c.data&&c.data.success)for(var d in b.photos)if(b.photos[d].id===a.id){b.photos.splice(d,1);break}})},b.photo=null,b.editPhoto=function(a){b.photo=a,b.artists.watchPhoto()},b.artists={load:function(a){return f.get("artists",{q:a,"return":"data"})},tagCounter:0,added:function(a){b.artists.tagCounter++,a._id||(a._id=b.artists.tagCounter,a.guest=!0)},getIds:function(){var a=[];if(b.photo.artists&&b.photo.artists.length)for(var c in b.photo.artists)a.push(b.photo.artists[c].id);return a},save:function(){b.artists.delay&&e.cancel(b.artists.delay),b.artists.delay=e(function(){f.put("me/photo/"+b.photo.id,{title:b.photo.title,artists:b.artists.getIds()}).then(function(a){})},1e3)},watcher:[],delay:null,watchPhoto:function(){b.artists.watcher.length&&(b.artists.watcher[0](),b.artists.watcher[1](),b.artists.watcher=[]),b.artists.watcher.push(b.$watchCollection("photo.artists",function(a,c){a&&c&&a.length!==c.length&&b.artists.save()})),b.artists.watcher.push(b.$watch("photo.title",function(a,c){a!==c&&b.artists.save()}))}},b.commentSource="",b.modal={id:null,index:"id",items:[],set:function(a,c,d){e(function(){b.modal.items=a,b.modal.index=c,b.modal.id=d},1)}},b.share={active:!1,show:function(){b.share.active=!0}},b.menu={back:function(){return d.go("landing-now")},others:function(){d.go("report",{url:d.href(d.current.name,d.params)})},recommended:!1,favorited:!1,recommend:function(){var a="artists/"+d.params.username+"/recommend",c=b.menu.recommended?f["delete"](a):f.post(a);c.then(function(a){a.data.success&&(b.menu.recommended=!b.menu.recommended)})},favorite:function(){var a="artists/"+d.params.username+"/favorite",c=b.menu.favorited?f["delete"](a):f.post(a);c.then(function(a){a.data.success&&(b.menu.favorited=!b.menu.favorited)})},share:function(){},map:function(){d.go("map")}},b.artist={},b.touch=new Touch,b.showAll=!1,b.showExhibition=function(a){return b.artist.exhibitions[a].active=!!b.artist.exhibitions[a].active,b.artist.exhibitions[a].active!==b.showAll},b.loadArtist=function(a){f.get("artists/"+d.params.username).then(function(a){var c=a.data;return c._id&&c.id?(b.menu.favorited=c.favorite,b.menu.recommended=c.recommend,b.commentSource="artists/"+c.username+"/comments",b.photos=c.album&&c.album.photos?c.album.photos:[],b.photos.sort(function(a,b){return i(b.created).isAfter(a.created)?1:-1}),void(b.artist={id:c._id||c.id||null,name:c.name,photo:c.photo||null,description:c.description,websites:c.websites,links:c.links,publications:[],genres:c.genres,exhibitions:c.exhibitions,feedback:[{date:"2015-01-08",content:"Review of the present exhibition at HBL: http://www.hbl.fi/128449032875",author:{name:"Forum Box",website:"http://forum-box.com"}},{date:"2015-01-01",content:"Hevoset Taskussa opening event today at 5pm, welcome!",author:{name:"Forum Box",website:"http://forum-box.com"}},{date:"2014-12-21",content:"Forum Box was listed as Editor’s Choice venue at  Visit Finland art section. http://www.visitfinland.fi/art/forumbox ",author:{name:"Forum Box",website:"http://forum-box.com"}}]})):(d.go("404"),!1)})["catch"](function(a,b,c,e){console.log("Error caught"),console.log(a),console.log(b),console.log(c),console.log(e),d.go("404")})},b.loadArtist()}function SearchController(a,b,c,d,e,f,g,h,i,j,k){d.search={q:g.q?g.q+"":"",results:[],busy:!1,limit:10,forced:!1,byCity:!1,exec:function(a,b){d.search.delay&&c.cancel(d.search.delay),d.search.delay=c(function(){return a&&(d.search.q="",d.where.city=""),!d.search.busy&&(!!(a||d.search.q.trim()||b)&&(d.search.busy=!0,void j.get("search",{q:d.search.q,date:d.when.date.format("YYYY-MM-DD"),city:d.where.city,limit:d.search.limit}).then(function(c){d.search.results=c.data,d.search.busy=!1,d.search.forced=!!a,d.search.byCity=!!b})))},1e3)},delay:null,watch:function(){d.$watch("search.q",function(a,b){a!==b&&d.search.exec()}),d.$watch("when.date",function(a,b){a!==b&&d.search.exec(!0)}),d.$watch("where.city",function(a,b){a!==b&&d.search.exec()})},suggestions:[],getSuggestions:function(){j.get("search/suggestions").then(function(a){d.search.suggestions=a.data||[]})}},angular.element(b).find('.main input[name="q"]:first').focus().select(),d.main={back:function(){return f.go("landing-now")},settings:function(){f.go("settings")}};for(var l=i.utc(),m=l.clone();;)if(m.add(1,"days"),1===m.isoWeekday()){for(;m.isoWeekday()<=5;)m.add(1,"days");break}d.when={active:!1,date:l.clone(),days:[{title:"Today",date:l},{title:"Next weekend",date:m},{title:"Next 7 days",date:l.clone().add(7,"days")}],activeDay:function(a){return a.format("YYYY-MM-DD")===this.date.format("YYYY-MM-DD")},calendars:[{month:l.clone().format("YYYY-MM"),show:!0},{month:l.clone().add(1,"months").format("YYYY-MM"),show:!0},{month:l.clone().add(2,"months").format("YYYY-MM"),show:!0}],rangeCache:null,rawRange:function(){return d.when.rangeCache||(d.when.rangeCache={start:l.clone().startOf("month"),end:l.clone().add(3,"months").startOf("month")}),d.when.rangeCache},range:function(){var a=d.when.rawRange();return{start:a.start.format("YYYY-MM-DD"),end:a.end.format("YYYY-MM-DD")}},inSchedules:[],schedules:{},getSchedules:function(){j.get("events/schedules",d.when.range()).then(function(a){d.when.inSchedules=a.data||[],d.when.inSchedules.forEach(function(a){a.startDate=i.utc(a.startDate),a.endDate=i.utc(a.endDate)})})},pick:function(a){this.date=a,c(function(){d.when.active=!1},400)},watch:function(){d.$watch("search.date",function(a,b){a!==b&&d.search.exec()})},hasSchedule:function(a){if(a){var b=a.format("YYYY-MM-DD");if(d.when.inSchedules.length){if("undefined"!=typeof d.when.schedules[b])return d.when.schedules[b];var c=!1;for(var e in d.when.inSchedules){var f=d.when.inSchedules[e];if(a.diff(f.startDate,"days")>=0&&a.diff(f.endDate,"days")<0){c=!0;break}}return d.when.schedules[b]=c,c}}return!1}},d.where={q:"",active:!1,city:"",cities:[],delay:null,setActive:function(a){c(function(){d.where.city=a,d.where.q="",d.cities=[],d.where.active=!1},1)},search:function(){j.get("search/cities",{q:d.where.q}).then(function(a){d.where.cities=a.data.data||[]})},watch:function(){d.$watch("where.q",function(a,b){a!==b&&(d.where.delay&&c.cancel(d.where.delay),d.where.delay=c(function(){d.where.search()},1e3))}),d.$watch("where.city",function(a,b){a!==b&&d.search.exec(!1,!!d.where.city)})}},d.save={id:null,active:!1,name:"",searches:[],select:function(a){d.save.id=a.id,d.save.name=a.name,d.search.q=a.keyword,d.when.date=i(a.date),d.where.city=a.city,d.save.active=!1},loadSearches:function(){return!!h.token&&void j.get("me/searches").then(function(a){d.save.searches=a.data.data||[]})},settings:function(){},remove:function(a){return!!h.token&&void j["delete"]("me/searches/"+a).then(function(){d.save.loadSearches()})},saving:null,submit:function(){return!d.save.saving&&(!!(d.search.q&&d.save.name&&d.where.city)&&(d.save.saving=!0,void j.post("me/searches",{name:d.save.name,keyword:d.search.q,date:d.when.date,city:d.where.city}).then(function(a){d.save.loadSearches(),d.save.saving=!1,d.save.name=""})))}},d.search.getSuggestions(),d.search.watch(),d.search.exec(),d.where.watch(),d.save.loadSearches(),k.cityPromise.then(function(){d.where.city=k.city}),d.when.getSchedules()}function mainConfig(a,b,c,d){b.otherwise("/landing"),a.state("splash",{url:"/",templateUrl:root+"/modules/main/views/splash.client.view.html"}).state("authentication",{url:"/authentication?action&message&next",templateUrl:root+"/modules/main/views/authentication.client.view.html",filters:["notLoggedIn"]}).state("forgot-password",{url:"/forgot-password?email&code",templateUrl:root+"/modules/main/views/forgot-password.client.view.html",filters:["notLoggedIn"]}).state("settings",{url:"/settings",templateUrl:root+"/modules/main/views/settings.client.view.html"}).state("feedback",{url:"/feedback",templateUrl:root+"/modules/main/views/feedback.client.view.html"}).state("report",{url:"/report?url",templateUrl:root+"/modules/main/views/report.client.view.html"}).state("invite",{url:"/invite",templateUrl:root+"/modules/main/views/invite.client.view.html"}).state("about-terms",{url:"/about-terms",templateUrl:root+"/modules/main/views/about-terms.client.view.html"}).state("privacy-policy",{url:"/privacy-policy",templateUrl:root+"/modules/main/views/privacy-policy.client.view.html"}).state("profile",{url:"/profile",templateUrl:root+"/modules/main/views/profile.client.view.html"}).state("landing-artview",{url:"/landing/artview",templateUrl:root+"/modules/main/views/landing/artview.client.view.html"}).state("landing-artcache",{url:"/landing/artcache",templateUrl:root+"/modules/main/views/landing/artcache.client.view.html"}).state("landing-now",{url:"/landing",templateUrl:root+"/modules/main/views/landing/now.client.view.html"}).state("landing-favorites",{url:"/landing/favorites",templateUrl:root+"/modules/main/views/landing/favorites.client.view.html"}).state("landing-lastchance",{url:"/landing/lastchance",templateUrl:root+"/modules/main/views/landing/lastchance.client.view.html"}).state("venue-create",{url:"/venue/create",templateUrl:root+"/modules/main/views/venue/create.client.view.html",filters:["loggedIn"]}).state("venue",{url:"/venue/:permalink",templateUrl:root+"/modules/main/views/venue.client.view.html"}).state("venue-edit",{url:"/venue/:permalink/edit",templateUrl:root+"/modules/main/views/venue/edit.client.view.html",filters:["loggedIn"]}).state("exhibition-create",{url:"/event/create?venue",templateUrl:root+"/modules/main/views/exhibition/create.client.view.html",filters:["loggedIn"]}).state("exhibition",{url:"/event/:permalink",templateUrl:root+"/modules/main/views/exhibition.client.view.html"}).state("exhibition-edit",{url:"/event/:permalink/edit",templateUrl:root+"/modules/main/views/exhibition/edit.client.view.html",filters:["loggedIn"]}).state("artist",{url:"/artist/:username",templateUrl:root+"/modules/main/views/artist.client.view.html"}).state("search",{url:"/search?q",templateUrl:root+"/modules/main/views/search.client.view.html"}).state("map",{url:"/map?event&venue",templateUrl:root+"/modules/main/views/map.client.view.html"}).state("artcache",{url:"/artcache",templateUrl:root+"/modules/main/views/artcache.client.view.html"}).state("404",{url:"/404",templateUrl:root+"/modules/main/views/404.client.view.html"}),c.configure({key:"AIzaSyBMV_9vKwdNvtkqIOH0CCnhJgumS1a-AUw",v:"3.17",libraries:"geometry"}),d.setActiveInterpolation("tagsInput",{placeholder:!0})}function initMain(a,b,c,d,e,f,g,h,i){var j=["splash"];a.$on("$stateChangeStart",function(a,b){var c=f.getLanguage();d.token?_.indexOf(j,b.name)>=0&&(a.preventDefault(),e.go("landing-now")):c?_.indexOf(j,b.name)>=0&&(a.preventDefault(),e.go("authentication")):_.indexOf(j,b.name)<0&&(a.preventDefault(),e.go("splash"))}),a.$on("$stateChangeSuccess",function(b,c,d,e,f){a.previousState=e.name,a.$broadcast("stateChanged",{fromState:e,fromParams:f,toState:c,toParams:d})}),a.$on("$viewContentLoaded",function(a){b.ga("send","pageview",{page:c.url()})}),a.scrollTop=function(){b.scrollTo(0,0)},a.$currentCity=null,a.$on("$changeCity",function(b,c){a.$currentCity=c||null,a.$currentCity&&a.$currentCity._id&&g.put("location/current",{id:a.$currentCity._id}).then(function(a){})}),angular.element(b.document).on("click",function(b){a.$broadcast("bodyClick",b)});var k=function(){var a=angular.element(window),b=a.width(),c=null;return b<=725?c="mobile":b>=726&&b<=1110?c="tablet":b>=1111&&b<=1420?c="desktop":b>=1421&&b<=1620?c="largeDesktop":b>=1621&&(c="extraLargeDesktop"),c};angular.element(window).resize(function(){a.$broadcast("windowResized",b);var c=k();device!==c&&(device=c,a.$broadcast("deviceChanged",device))});var l=function(){angular.element("body:first").removeClass("en fi se de").addClass(b.lang)};a.getLang=function(){return b.lang},a.brickWidth=function(){return{extraLargeDesktop:296,largeDesktop:326,desktop:339,tablet:328,mobile:270}[device]},a.$watch("getLang()",function(a,b){b!==a&&l()}),l(),device=k(),jQuery.extend(jQuery.easing,{easeOutQuint:function(a,b,c,d,e){return d*((b=b/e-1)*b*b*b*b+1)+c}})}var ApplicationConfiguration=function(){var a="mean",b=["ngResource","ngAnimate","ui.router","ui.utils","wu.masonry","angularMoment","duScroll","infinite-scroll","hmTouchEvents","uiGmapgoogle-maps","checklist-model","ngFileUpload","ngTagsInput","ngMask","geolocation","datePicker","720kb.tooltips","720kb.socialshare"],c=function(b,c){angular.module(b,c||[]),angular.module(a).requires.push(b)};return{applicationModuleName:a,applicationModuleVendorDependencies:b,registerModule:c}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function(a){a.html5Mode(!0).hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("main"),angular.module("main").factory("Authentication",["$window","$q","$http",function(a,b,c){var d={token:a.token,user:null,promise:null};return d.swear=function(){var e=b.defer();return c.get("/api/me",{params:{token:a.token}}).then(function(a){a.data.exception||(d.user=a.data),e.resolve(d)}),d.promise=e.promise,d},d.swear()}]),angular.module("main").factory("LangSvc",LanguageService),LanguageService.$inject=["Authentication","APP_KEYS"],angular.module("main").service("Middleware",["Authentication","$state",function(a,b){var c={notLoggedIn:function(c,d){return!a.token||(b.go("landing-now"),!1)},loggedIn:function(c,d){return!!a.token||(b.go("authentication",{next:b.href(c.name,d)}),!1)}};this.filter=function(a,b){if(!a||!a.filters)return!0;for(var d in a.filters)if(!c[a.filters[d]](a,b))return!1;return!0}}]),angular.module("main").service("API",["$http","$state","$q","Authentication",function(a,b,c,d){var e=this;this.root="/api/";var f=function(a){return e.root+("/"===a.charAt(0)?a.substr(1):a)},g=function(a){return d.token&&(a.token=d.token),a},h=function(a,c){switch(a.group){case"general":console.log(c),alert(a.message);break;case"unauthorized":d.token=null,b.go("authentication",{action:"login",message:"Please login",next:b.href(b.current.name,b.params)})}return a},i=function(a){var b=c.defer();return a.then(function(a){b.resolve(a)},function(a){a.data&&a.data.exception&&b.reject(h(a.data.exception,a))}),b.promise};this.get=function(b,c){return i(a.get(f(b),{params:g(c||{})}))},this.post=function(b,c,d){return i(a.post(f(b),c,{params:g(d||{})}))},this.put=function(b,c,d){return i(a.put(f(b),c,{params:g(d||{})}))},this["delete"]=function(b,c){return i(a["delete"](f(b),{params:g(c||{})}))}}]),angular.module("main").provider("location",function(){var a=function(a){return a*(Math.PI/180)},b=function(b,c,d,e){var f=6371,g=a(d-b),h=a(e-c),i=Math.sin(g/2)*Math.sin(g/2)+Math.cos(a(b))*Math.cos(a(d))*Math.sin(h/2)*Math.sin(h/2),j=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),k=f*j;return k};this.$get=["geolocation","$q","$rootScope","$timeout","uiGmapGoogleMapApi","API",function(a,c,d,e,f,g){var h={},i=c.defer();h.promise=i.promise;var j=c.defer();h.cityPromise=j.promise,h.city="";var k=a.getLocation({timeout:2e4}),l=c.defer(),m=function(){i.resolve(h),g.get("location/current",{coords:[h.current.latitude,h.current.longitude].join(",")}).then(function(a){a.data.name&&d.$broadcast("$changeCity",a.data,!0)})["finally"](l.resolve)};return k.then(function(a){h.current=a.coords,m()})["catch"](function(){h.current={latitude:60.1698557,longitude:24.938379},m()}),c.all([f,k,l.promise]).then(function(a){var b=a[0],c=a[1].coords,d=new b.LatLng(c.latitude,c.longitude),e=new b.Geocoder;e.geocode({latLng:d},function(a,b){if("OK"===b.toUpperCase()){a.find(function(a){return!!a.address_components&&!!a.address_components.find(function(a){var b=a.types&&a.types.indexOf("locality")>=0;return b&&(h.city=a.long_name||a.short_name||"",h.city||(b=!1)),b})})||""}j.resolve(h)})}),h.distance=function(a,c){return c||(c=h.current),a&&a.latitude&&c&&c.latitude?b(a.latitude,a.longitude,c.latitude,c.longitude):-1},h.format=function(a){return a<0?"Calculating distance...":a<1?Math.round(a/1e3)+"m":a.toFixed(3)+"km"},h}]}),angular.module("main").directive("calendar",["moment",function(a){var b=function(b,c,d,e,f){var g=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],h=1;b.parent=b.$parent;var i=function(a){for(var b in g)if(b=parseInt(b),parseInt(a)===b+1||0===g[b].toLowerCase().indexOf(a))return b+1;return h},j={startOfWeek:i(d.startOfWeek||h)};b.month=d.month?a(d.month+"-01"):a(),b.weekdays=[],function(){for(var c=g.length,d=j.startOfWeek;c>0;)b.weekdays.push(a().isoWeekday(d)),d++,d>g.length&&(d=1),c--}();for(var k=b.month.daysInMonth(),l=b.month.clone().startOf("month"),m=l.isoWeekday(),n=[],o=g.length;o>0;){var p=j.startOfWeek+(g.length-o);p>g.length&&(p-=g.length),n.push(p),o--}b.alert=function(a){console.log(a)},b.weeks=[];var q=0;b.isActive=function(a){return!(!a||!b.date)&&a.format("YYYY-MM-DD")===b.date.format("YYYY-MM-DD")};for(var r=!0;r;){var s=[];for(var t in n)if((q>0||m===n[t])&&r){var u=l.clone().add(q,"days");s.push(u),q++,q>=k&&(r=!1)}else s.push(null);b.weeks.push(s)}f(b,function(a,b){c.append(a)})};return{link:b,scope:{date:"="},restrict:"E",transclude:!0}}]),angular.module("main").directive("comments",["API","$window","Authentication","$state",function(a,b,c,d){var e=function(e,f,g,h,i){e.comments=[],e.count=0,e.query={start:g.start||0,limit:g.limit||5,earliest:null},e.last=!1,e.reset=function(){return e.comments=[],e.query.start=g.start||0,e};e.pushComment=function(a,b){b?(e.comments.unshift(a),e.query.earliest=a.created||null):e.comments.push(a),e.query.start++},e.busy=!1,e.load=function(){return!e.busy&&(e.busy=!0,a.get(e.source,e.query).then(function(a){if(e.last=!!a.data.last,e.count=a.data.count,a.data.data)for(var b in a.data.data)e.pushComment(a.data.data[b],!0);e.busy=!1}),e)},e.submit=function(){return!(e.busy||!angular.element.trim(e.content))&&(e.busy=!0,void a.post(e.source,{content:e.content}).then(function(a){e.pushComment(a.data),e.count++,e.busy=!1,e.content=""}))},e.canRemove=function(a){return c.token&&(a.owner===c.user._id||a.owner._id===c.user._id||b.admin||e.owners&&e.owners.indexOf(c.user._id)>=0)},e.remove=function(b){return!!confirm("Are you sure you want to remove this comment?\n\nPress OK to proceed")&&void a["delete"](e.source+"/"+b._id).then(function(a){var c="";for(var d in e.comments)if(e.comments[d]._id===b._id){c=d;break}e.comments.splice(c,1)})},e.artistPage=function(a,b){return a.owner.isArtist?d.href("artist",{username:a.owner.username}):b||""},e.ownerName=function(a){return a.owner.name.full},e.$watch("source",function(a,b){a!==b&&e.reset().load()}),e.source&&e.reset().load(),i(e,function(a,b){f.append(a)})};return{link:e,scope:{source:"=",owners:"="},restrict:"E",transclude:!0}}]),angular.module("main").directive("redirector",["$window","$timeout","$state",function(a,b,c){var d=function(d,e,f,g,h){d.$seconds=d.seconds||5;var i=angular.element(a),j=function(){var a=e.find(".redirector-wrap:first"),b=i.height()/2-a.height()/2;a.css("margin-top",b+"px")};d.$on("windowResized",function(a){j()});var k=function(){d.$seconds<=0?c.go(d.state[0],d.state[1]):b(function(){d.$seconds--,k()},1e3)},l=!1;d.$watch("state",function(a,b){a!==b&&a&&!l&&(l=!0,e.addClass("show"),k())}),h(d,function(a,b){e.append(a),j()})};return{link:d,scope:{state:"=",seconds:"=?"},transclude:!0,restrict:"E"}}]),angular.module("main").directive("confirm",["$window","$timeout","$state",function(a,b,c){var d=function(b,c,d,e,f){var g=angular.element(a),h=function(){var a=c.find(".confirm-wrap:first"),b=g.height()/2-a.height()/2;a.css("margin-top",b+"px")};b.$on("windowResized",function(a){h()}),b.$cancel=function(){b.show=!1},b.$watch("show",function(a,b){a!==b&&(a?(c.addClass("show"),h()):c.removeClass("show"))}),f(b,function(a,b){c.append(a)})};return{link:d,scope:{action:"=",show:"="},transclude:!0,restrict:"E"}}]),angular.module("main").directive("popup",["$rootScope",function(a){var b=function(a,b,c,d,e){a.$on("openPopup",function(c,d){d===a.name&&b.addClass("open")}),a.$on("closePopup",function(b,c){c===a.name&&a.close()}),a.close=function(){b.removeClass("open"),a.closed&&(console.log(a.closed),a.$eval(a.closed))},e(a,function(a,c){b.append(a)})};return{link:b,restrict:"E",scope:{name:"=",closed:"@"},transclude:!0}}]),angular.module("main").directive("photo",["Authentication",function(a){var b=function(b,c){b.user=b.user||null,c.css("background-image","");var d=function(){if(!b.user.photo||!b.user.photo.source)return c.removeClass("sourced"),!1;var a=b.user.photo.source;"/"!==a.charAt(0)&&(a="/"+a),a="url('"+a.replace("'","\\'")+"')",c.css("background-image",a).addClass("sourced")};b.user||a.promise.then(function(){b.user=a.user}),b.$watch("user",function(a,c){b.user&&b.user.photo&&d()})};return{link:b,scope:{user:"=?"},restrict:"E"}}]),angular.module("main").directive("carousel",["$q","$timeout",function(a,b){var c={},d=function(a,b){},e=["$element","$scope",function(b,d){var e=a.defer(),f=!1;d.$element=b,d.$ready=e.promise,d.$isReady=function(){return f};var g=function(a,b){c[a]&&c[a].forEach(function(a){a.apply(d,b)})};return d.listen=function(a,b){c[a]||(c[a]=[]),c[a].push(b)},d.width=function(){return b.width()},d.control.focus=function(a){g("focus",[a])},d.control.ready=d.$ready,d.control.isReady=d.$isReady,d.$watch("width()",function(a,b){!f&&a>100&&(f=!0,e.resolve(d),console.log("--Carousel Width--"),console.log(a)),g("carouselWidthChanged",[a])}),d}];return{link:d,controller:e,restrict:"A",scope:{control:"=carousel"}}}]).directive("carouselList",[function(){var a=function(a,b,c,d){a.$carousel=d},b=["$element","$scope",function(a,b){return b.$element=a,b.recalculateWidth=function(){if(!b.$carousel.$isReady())return!1;var c=0;a.find("[carousel-item], [data-carousel-item]").each(function(){c+=angular.element(this).width()}),a.css("width",c+"px")},b}];return{link:a,controller:b,restrict:"A",require:"^carousel",scope:{options:"=carouselList"}}}]).directive("carouselItem",[function(){var a=function(a,b,c,d){a.$list=d,a.$list.$carousel.$ready.then(function(b){a.recalculateWidth()}),a.$list.$carousel.listen("focus",function(a){console.log(a)})},b=["$element","$scope",function(a,b){return b.$element=a,b.recalculateWidth=function(){if(!b.$list.$carousel.$isReady())return!1;var c=b.$list.$carousel.width()*b.options.width;a.css("width",c+"px")},b.width=function(){return a.width()},b.$watch("options.width",function(a,c){b.recalculateWidth()}),b.$watch("width()",function(a,c){b.$list.recalculateWidth()}),b}];return{link:a,controller:b,restrict:"A",require:"^carouselList",scope:{options:"=carouselItem"}}}]),angular.module("main").factory("genres",[function(){return["ceramic art","collage","comics","community art","digital art","drawing","film","games","glass art","illustration","installation art","land art","light art","media art","painting","participatory art","performance art","photography","printmaking","sculpture","site specific art","sound art","street art","textile art","video art","other"]}]),angular.module("main").factory("translations",["$rootScope","$window","API",function(a,b,c){var d=[{en:"About & Terms",fi:"Käyttöehdot",sv:"Om Art Advisor och Villkor",de:"About + AGB"},{en:"About and terms",fi:"Käyttöehdot",sv:"Användarvillkor",de:"Bedingungen"},{en:"Additional content",fi:"Lisätietoja",sv:"Ytterligare innehåll",de:"Zusätzliche Inhalte"},{en:"Address",fi:"Osoite",sv:"Adress",de:"Adresse"},{en:"Admission",fi:"Pääsymaksu",sv:"Biljetter",de:"Aufnahmegebühr"},{en:"Admission fee",fi:"Sisäänpääsymaksu",sv:"Inträdesavgift",de:"Aufnahmegebühr"},{en:"All Rights Reserved",fi:"Kaikki oikeudet pidätetään",sv:"Alla rättigheter förbehållna.",de:"Alle Rechte vorbehalten"},{en:"Apr",fi:"Huhti",sv:"April",de:"April"},{en:"Art Cache",fi:"Taidekätkö",sv:"Exklusiv konstsamling",de:"Kunst Cache"},{en:"Art Cache Helsinki",fi:"Art Cache Helsinki",sv:"Art Cache Helsinki",de:"Art Cache Helsinki"},{en:"Art Genres",fi:"Taidelajit",sv:"Konstformer",de:"Genre"},{en:"Art View",fi:"Taidenäkymä",sv:"Visa konst",de:"Kunst Anzeigen"},{en:"Art genre",fi:"Taidelaji",sv:"Konstform",de:"Art genre"},{en:"Art genre(s) represented",fi:"Edustetut taidelajit",sv:"Representerade konstformer",de:"Kunstgenre"},{en:"Art lover",fi:"Taiteen ystävä",sv:"Konstvän",de:"Kunstliebhaber"},{en:"Art museum",fi:"Taidemuseo",sv:"Konstmuseum",de:"Kunstmuseum"},{en:"Artist",fi:"Taiteilija",sv:"Konstnär",de:"Künstler"},{en:"Artist run",fi:"Taiteilijavetoinen",sv:"Konstnärsdrivet",de:"Produzentengalerie / artist run"},{en:"Artist studio",fi:"Taiteilijan työhuone",sv:"Konstnärens arbetsrum",de:"Künstleratelier"},{en:"Artist(s)",fi:"Taiteilija(t)",sv:"Konstnär(er)",de:"Künstler"},{en:"Artists",fi:"Taiteilijat",sv:"konstnärer",de:"Künstler"},{en:"Aug",fi:"Elo",sv:"Aug",de:"August"},{en:"By joining Art Advisor, you agree to our",fi:"Liittymällä Art Advisor:iin, hyväksyt",sv:"Genom att gå med i Art Advisor, godkänner du våra",de:"Mit Ihrer Anmeldung auf Art Advisor erklären Sie sich mit Unseren"},{en:"By joining ArtAdvisor, you agree to our Terms of Service and Privacy Policy",fi:"Liittymällä ArtAdvisor:iin, hyväksyt käyttöehdot ja tietosuojakäytännöt",sv:"Genom att gå med i ArtAdvisor, godkänner du våra villkor och vår sekretesspolicy",de:"Mit Ihrer Anmeldung auf ArtAdvisor erklären Sie sich mit Unseren Servicebedingungen sowie unserer Datenschutzerklärung einverstanden."},{en:"Calculating distance",fi:"Laskee etäisyyden",sv:"Räkna avstånd",de:"Entfernung berechnen"},{en:"Cancel",fi:"Peru",sv:"Ångra",de:"Löschen"},{en:"Ceramic art",fi:"Keramiikka",sv:"Keramik",de:"Keramik-Kunst"},{en:"Change language",fi:"Vaihda kieli",sv:"Ändra språk",de:"Sprache ändern"},{en:"Change password",fi:"Vaihda salasana",sv:"Ändra lösenord",de:"Passwort ändern"},{en:"Change user type",fi:"Vaihda käyttäjän tyyppi",sv:"Ändra användartyp",de:"Ändere den Benutzer-Typ"},{en:"Choose an existing venue",fi:"Valitse olemassa oleva paikka",sv:"Välj en existerande plats",de:"Wähle eine bereits bestehende Veranstaltung"},{en:"Choose existing venue",fi:"Valitse tapahtumapaikka",sv:"Välj plats för evenemang",de:"Wähle einen Veranstaltungsort"},{en:"Cities",fi:"Kaupungit",sv:"Städer",de:"Städte"},{en:"Close account",fi:"Sulje käyttäjätili",sv:"Stäng användarkontot",de:"Konto schliessen"},{en:"Closed today",fi:"Suljettu tänään",sv:"Stängt idag",de:"Heute geschlossen"},{en:"Collage",fi:"Kollaasi",sv:"Kollage",de:"Collage"},{en:"Comics",fi:"Sarjakuvataide",sv:"Seriekonst",de:"Comics"},{en:"Comments",fi:"Kommentit",sv:"Kommentarer",de:"Kommentare"},{en:"Commercial",fi:"Kaupallinen",sv:"Kommersielt",de:"Kommerziell"},{en:"Completing password reset",fi:"Salasana on nyt uusittu",sv:"Ditt lösenord har förnyats",de:"Passwort-Zurücksetzung abschliesen"},{en:"Contact",fi:"Yhteystiedot",sv:"Kontakt",de:"Kontakt"},{en:"Contemporary",fi:"Nykytaide",sv:"Nutidskonst",de:"Zeitgenössisch"},{en:"Create event",fi:"Luo tapahtuma",sv:"Skapa evenemang",de:"Erstelle eine Veranstaltung"},{en:"Create new event",fi:"Luo uusi tapahtuma",sv:"Skapa nytt evenemang",de:"Neue Veranstaltung"},{en:"Create new venue",fi:"Luo uusi paikka",sv:"skapa ny lokal",de:"Neuer Verastallungsort"},{en:"Curated by",fi:"Järjestäjä",sv:"Arrangerat av",de:"Kuratiert von"},{en:"Curator studio",fi:"Kuraattorin työhuone",sv:"Kuratorns arbetsrum",de:"Kuratorenbüro"},{en:"Current city",fi:"Nykyinen kaupunki",sv:"Nuvarande stad",de:"Aktuelle Stadt"},{en:"Date",fi:"Päivä",sv:"Datum",de:"Tag"},{en:"Days",fi:"Päivät",sv:"Dagar",de:"Tage"},{en:"Dec",fi:"Joulu",sv:"Dec",de:"Dezember"},{en:"Digital art",fi:"Digitaalinen taide",sv:"Digital konst",de:"Digital Art"},{en:"Drawing",fi:"Piirrustus",sv:"Teckning",de:"Zeichnung"},{en:"ENG",fi:"FIN",sv:"SWE",de:"DE"},{en:"Edit event",fi:"Muokkaa tapahtumaa",sv:"Redigera evenemang",de:"Veranstaltung bearbeiten"},{en:"Edit profile",fi:"Muokkaa profiilia",sv:"Redigera profil",de:"Profil bearbeiten"},{en:"Edit venue",fi:"Muokkaa paikkaa",sv:"redigera lokal",de:"Verastallungsort bearbeiten"},{en:"Email",fi:"E-mail",sv:"E-post",de:"Email"},{en:"Email a friend",fi:"Jaa ystävälle",sv:"Dela med vän",de:"E-Mail an einen Freund"},{en:"Email already in use",fi:"Sähköpostiosoite on jo käytössä",sv:"Denna e-post är redan i användning",de:"E-Mail-Adresse wird bereits benutzt"},{en:"Enter admission fee(s) currency",fi:"Valitse sisäänpääsymaksun valuutta",sv:"Välj valuta för inträdesavgift",de:"Wähle die Währung der Eintrittszahlung"},{en:"Event",fi:"Tapahtuma",sv:"Evenemang",de:"Veranstaltung"},{en:"Event name",fi:"Tapahtuman nimi",sv:"Namn på evenemang",de:"Name des Veranstaltung"},{en:"Event organizer",fi:"Tapahtumajärjestäjä",sv:"Arrangör",de:"Veranstalter"},{en:"Event successfully created",fi:"Tapahtuma onnistuneesti luotu",
sv:"Evenemanget skapat lyckat",de:"Die Veranstaltung wurde erfolgreich erstellt"},{en:"Events",fi:"Tapahtumat",sv:"Evenemang",de:"Veranstaltungen"},{en:"Facebook",fi:"Facebook",sv:"Facebook",de:"Facebook"},{en:"Favorites",fi:"Suosikit",sv:"Favoriter",de:"Favoriten"},{en:"Favourites",fi:"Suosikit",sv:"Favoriter",de:"Favoriten"},{en:"Feb",fi:"Helmi",sv:"Feb",de:"Februar"},{en:"Feedback",fi:"Palaute",sv:"Feedback",de:"Rückmeldung"},{en:"Film",fi:"Elokuva",sv:"Film",de:"Film"},{en:"Forest",fi:"Metsä",sv:"Skog",de:"Wald"},{en:"Forgot password?",fi:"Unohditko salasanan?",sv:"Glömt lösenordet?",de:"Passwort vergessen?"},{en:"Fri",fi:"Pe",sv:"Fre",de:"Fr"},{en:"Friday",fi:"Perjantai",sv:"Fredag",de:"Freitag"},{en:"Gallery",fi:"Galleria",sv:"Galleri",de:"Galerie"},{en:"Games",fi:"Pelit",sv:"Spel",de:"Spiele"},{en:"Genre",fi:"Laji",sv:"Genre",de:"Genre"},{en:"Glass art",fi:"Lasitaide",sv:"Glaskonst",de:"Glaskunst"},{en:"Go to map page",fi:"Siirry karttasivulle",sv:"Gå till kartsida",de:"Gehe zur Kartendienst-Seite"},{en:"Google",fi:"Google",sv:"Google",de:"Google"},{en:"Guestbook",fi:"Vieraskirja",sv:"Gästbok",de:"Gästebuch"},{en:"Historical",fi:"Historiallinen",sv:"Historisk",de:"Historisch"},{en:"Illustration",fi:"Kuvitus",sv:"Illustration",de:"illustration"},{en:"Information",fi:"Tiedot",sv:"Beskrivning av evenemang",de:"Veranstaltungsbeschreibung"},{en:"Installation art",fi:"Installaatiotaide",sv:"Installationskonst",de:"Installationskunst"},{en:"International",fi:"Kansainvälinen",sv:"Internationell",de:"International"},{en:"Invite friends",fi:"Kutsu ystäviä",sv:"Bjud in vänner",de:"Freunde einladen"},{en:"Jan",fi:"Tammi",sv:"Jan",de:"Januar"},{en:"Join",fi:"Liity",sv:"Gå med",de:"beitreten-Anmelden"},{en:"Join with Facebook",fi:"Liity Facebook:in avulla",sv:"Gå med via Facebook",de:"Anmelden mit Facebook"},{en:"Join with Google+",fi:"Liity Google + avulla",sv:"Gå med via Google+",de:"Anmelden mit Google+"},{en:"Jul",fi:"Heinä",sv:"Juli",de:"Juli"},{en:"Jun",fi:"Kesä",sv:"Juni",de:"Juni"},{en:"Keywords",fi:"Hakusanat",sv:"Nyckelord",de:"Schlüsselwörter"},{en:"Land art",fi:"Maataide",sv:"Jordkonst",de:"Land-Art"},{en:"Last Chance",fi:"Vielä ehdit",sv:"Sista chansen",de:"Letzte Chance"},{en:"Lifestyle",fi:"Lifestyle",sv:"Livsstil",de:"Lifestyle"},{en:"Light art",fi:"Valotaide",sv:"Ljuskonst",de:"Licht-Kunst"},{en:"Linked accounts",fi:"Linkitetyt tilit",sv:"Länkade konton",de:"Verknüpfte Konten"},{en:"Links to other page",fi:"Linkit muille sivuille",sv:"Länkar till andra sidor",de:"Links to other page"},{en:"Links to other pages",fi:"Linkit muille sivuille",sv:"Länkar till andra sidor",de:"Links zu anderen Seiten"},{en:"Load images",fi:"Lataa kuvia",sv:"Ladda bilder",de:"Bilder laden"},{en:"Log in",fi:"Kirjaudu sisään",sv:"Logga in",de:"Log in"},{en:"Log in with Facebook",fi:"Kirjaudu Facebook:in avulla",sv:"Logga in med Facebook",de:"Log in mit Facebook"},{en:"Log in with Google+",fi:"Kirjaudu Google + avulla",sv:"Logga in med Google+",de:"Log in mit Google+"},{en:"Mar",fi:"Maalis",sv:"Mars",de:"März"},{en:"May",fi:"Touko",sv:"Maj",de:"Mai"},{en:"Media art",fi:"Mediataide",sv:"Mediekonst",de:"Medienkunst"},{en:"Message",fi:"Viesti",sv:"Meddelande",de:"Nachricht"},{en:"Modern",fi:"Moderni",sv:"Modern",de:"Modern"},{en:"Mon",fi:"Ma",sv:"Mån",de:"Mo"},{en:"Monday",fi:"Maanantai",sv:"Måndag",de:"Montag"},{en:"Months",fi:"Kuukaudet",sv:"Månader",de:"Monate"},{en:"Museum",fi:"Museo",sv:"Museum",de:"Museum"},{en:"My events",fi:"Minun tapahtumat",sv:"Mina evenemang",de:"Meine Veranstaltung"},{en:"My searches",fi:"Omat hakuni",sv:"Mina sökningar",de:"Meine Suchen"},{en:"My venues",fi:"Minun paikat",sv:"mina lokaler",de:"Mein Verastaltungsort"},{en:"New password",fi:"Uusi salasana",sv:"Nytt lösenord",de:"Neues Passwort"},{en:"New password again",fi:"Uusi salasana uudestaan",sv:"Nytt lösenord igen",de:"Altes Passwort wiederholen"},{en:"Next 7 days",fi:"Seuraavan viikon ajan",sv:"Nästa 7 dagar",de:"Nächste 7 Tage"},{en:"Next weekend",fi:"Ensi viikonloppuna",sv:"Nästa helg",de:"Nächstes Wochenende"},{en:"Notifications",fi:"Ilmoitukset",sv:"Meddelande",de:"Mitteilungen"},{en:"Nov",fi:"Marras",sv:"Nov",de:"November"},{en:"Now",fi:"Nyt",sv:"Nu",de:"Jetzt"},{en:"Now closed",fi:"Suljetut",sv:"Stängt",de:"Jetzt Geschlossen."},{en:"Now open",fi:"Avoimet",sv:"Öppet",de:"Jetzt geöffnet"},{en:"Oct",fi:"Loka",sv:"Okt",de:"Oktober"},{en:"Off",fi:"Pois",sv:"Av",de:"Aus"},{en:"Old password",fi:"Vanha salasana",sv:"Gammalt lösenord",de:"Altes Passwort"},{en:"On",fi:"Päällä",sv:"På",de:"Ein"},{en:"On / Off",fi:"Päällä / Pois",sv:"På / Av",de:"Ein / Aus"},{en:"Open dates",fi:"Aukiolopäivät",sv:"Öppetdagar",de:"Öffnungstage"},{en:"Open hours",fi:"Aukioloajat",sv:"Öppettider",de:"Öffnungszeiten"},{en:"Open today from",fi:"Avoinna tänään",sv:"Öppet idag",de:"Heute geöffnet von"},{en:"Opening hours",fi:"Aukioloajat",sv:"Öppettider",de:"Öffungzeiten"},{en:"Opening hours (for every weekday separately + holidays + other exceptional opening hours)",fi:"Aukioloajat  (valitse kaikki viikonpäivät erikseen + lomat + muut poikkeavat aukioloajat)",sv:"Öppettider",de:"Öffungzeiten"},{en:"Other",fi:"Muu",sv:"Annat",de:"Sonstiges"},{en:"Painting",fi:"Maalaustaide",sv:"Måleri",de:"Malerei"},{en:"Park",fi:"Puisto",sv:"Park",de:"Park"},{en:"Password does not match",fi:"Salasana ei täsmää",sv:"Lösenordet stämmer ej",de:"Das Passwort stimmt nicht"},{en:"Performance art",fi:"Performanssitaide",sv:"Performanskonst",de:"Performance-Kunst"},{en:"Phone number",fi:"Puhelin",sv:"Telefonnummer",de:"Telefonnummer"},{en:"Photography",fi:"Valokuvataide",sv:"Fotografi",de:"Fotografie"},{en:"Please add admission fee",fi:"Lisää pääsymaksu",sv:"Lägg till inträdesavgift",de:"Füge den Eintrittspreis hinzu"},{en:"Please add event name",fi:"Lisää tapahtuman nimi",sv:"Lägg till namn på evenemang",de:"Füge den Veranstaltungsnamen hinzu"},{en:"Please add the basic information about the event",fi:"Lisää tapahtuman tiedot",sv:"Lägg till information för evenemanget",de:"Bitte füge Grundinformationen über die Veranstaltung hinzu"},{en:"Please check your email for our instructions",fi:"Tarkista sähköpostistasi tarkemmat ohjeet",sv:"Kontrollera din e-post för våra instruktioner",de:"Schau bitte in deinem E-Mail-Eingang nach"},{en:"Please check your new email address for verification",fi:"Tarkista vahvistusviesti uudesta sähköpostiosoitteesta",sv:"Kontrollera din nya e-post",de:"Bitte prüfe deine neue E-Mail-Adresse"},{en:"Please choose at least one art genre",fi:"Valitse vähintään yksi taidelaji",sv:"Välj minst en konstform",de:"Wähle wenigstens eine Kunstgattung"},{en:"Please choose at least one venue type under gallery / public space / art museum / other",fi:"Valitse vähintään yksi tarkentava paikkatyyppi näiden alta Galleria / Taidemuseo / Julkinen tila / Muu",sv:"Välj minst en specifierande platstyp från Galleri / Konstmuseum / Allmän plats / Annan",de:"Wähle wenigstens einen Veranstaltungstyp unter Galerie / Kunstmuseum / Öffentlicher Raum / Anderer"},{en:"Please load at least one as the banner image of the event",fi:"Lataa vähintää yksi kuva tapahtuman bannerikuvaksi",sv:"Välj minst en bild som banner-bild för evenemanget",de:"Lade wenigstens ein Bild der Veranstaltung als Banner-Bild"},{en:"Please select a venue",fi:"Valitse paikka",sv:"Välj plats",de:"Wähle einen Ort"},{en:"Please select the artist(s)",fi:"Valitse taiteilija(t)",sv:"Välj konstnär(er)",de:"Wähle einen Künstler"},{en:"Please specify the details of your report",fi:"Ole hyvä ja kerro mitä raportointisi koskee",sv:"Var snäll och berätta vad din anmälan gäller",de:"Bitte nenne die Details deines Reports"},{en:"Printmaking",fi:"Taidegrafiikka",sv:"Konstgrafik",de:"Druckgrafik"},{en:"Privacy policy",fi:"Tietosuojakäytäntö",sv:"Sekretesspolicy",de:"Datenschutzbestimmungen"},{en:"Private house",fi:"Yksityisasunto",sv:"Privat lägenhet",de:"Privatwohnung"},{en:"Processing request",fi:"Pyyntöä käsitellään",sv:"Behandlar begäran",de:"Verarbeitungsanforderung"},{en:"Public building",fi:"Julkinen rakennus",sv:"Allmän byggnad",de:"Öffentliches Gebäude"},{en:"Public space",fi:"Julkinen tila",sv:"Allmän plats",de:"Öffentliches Gelände"},{en:"Recent cities",fi:"Viimeaikaiset kaupungit",sv:"Tidigare städer",de:"Letzte Stadt"},{en:"Report",fi:"Raportoi",sv:"Anmäl",de:"Report"},{en:"Report artist",fi:"Raportoi tapahtuma",sv:"Rapportera konstnär",de:"Artist Melden"},{en:"Report event",fi:"Raportoi tapahtuma",sv:"Rapportera evenemang",de:"Veranstaltungs"},{en:"Report event / venue / artist",fi:"Ilmianna tapahtuma / paikka / taiteilija",sv:"Anmäl evenemang / plats / konstnär",de:"Veranstaltungen / Veranstaltungsorte / Künstler melden"},{en:"Report this page",fi:"Ilmianna tämä sivu",sv:"Anmäl denna sida",de:"Seite melden"},{en:"Report venue",fi:"Raportoi tapahtuma",sv:"Rapportera lokal",de:"Veranstaltungsort"},{en:"SAVED",fi:"TALLENNETTU",sv:"SAVED",de:"SAVED"},{en:"Sat",fi:"La",sv:"Lör",de:"Sa"},{en:"Saturday",fi:"Lauantai",sv:"Lördag",de:"Samstag"},{en:"Save",fi:"Tallenna",sv:"Spara",de:"Speichern"},{en:"Saved searches",fi:"Tallenetut haut",sv:"Sparade sökningar",de:"Gespeicherte Suchanfragen"},{en:"Sculpture",fi:"Kuvanveisto",sv:"Skulptur",de:"Skulptur"},{en:"Search a city",fi:"Etsi kaupunkia",sv:"Sök på stad",de:"Stadt auswählen"},{en:"Search events, artists, genres…",fi:"Etsi tapahtumia, taiteilijoita, taidelajeja",sv:"Sök evenemang, artister, konstform",de:"Suche Veranstaltungen, artist, Genres ..."},{en:"Search keyword",fi:"Etsi tapahtumia, taiteilijoita, taidelajeja",sv:"Sök evenemang, artister, konstformer",de:"Suche Veranstaltungen, Künstler, Genres ..."},{en:"Search keywords",fi:"Hakusana",sv:"Sökord",de:"Stichwörter suchen"},{en:"Send this to email",fi:"Jaa sähköpostilla",sv:"Dela med e-post",de:"Als E-Mail verschicken"},{en:"Sending invitation...",fi:"Lähettää kutsuja...",sv:"Skickar inbjudningar...",de:"Die Einladung wird versendet..."},{en:"Sep",fi:"Syys",sv:"Sept",de:"September"},{en:"Settings",fi:"Asetukset",sv:"Inställningar",de:"Einstellungen"},{en:"Share",fi:"Jaa",sv:"Dela",de:"Teilen"},{en:"Share this to Facebook",fi:"Jaa Facebookissa",sv:"Dela på Facebook",de:"Auf Facebook teilen"},{en:"Share this to Twitter",fi:"Jaa Twitterissä",sv:"Dela på Twitter",de:"Auf Twitter teilen"},{en:"Short event",fi:"Lyhyt tapahtuma",sv:"Kort evenemang",de:"Kurzes Ereignis"},{en:"Short events",fi:"Lyhyet tapahtumat",sv:"Kortta evenemang",de:"Kurze Ereignisse"},{en:"Show more",fi:"Näytä lisää",sv:"Visa mer",de:"Mehr anzeigen"},{en:"Show more events",fi:"Näytä lisää tapahtumia",sv:"Visa fler evenmang",de:"Mehr Veranstaltungen anzeigen"},{en:"Show more favorites",fi:"Näytä lisää suosikkeja",sv:"Visa fler favoriter",de:"Mehr Favoriten anzeigen"},{en:"Show more venues",fi:"Näytä lisää paikkoja",sv:"visa fler lokaler",de:"Mehr Verastallungsorte anzeigen"},{en:"Show past events",fi:"Näytä menneet tapahtumat",sv:"Visa tidigare evenemang",de:"Vergangene Veranstaltungen anzeigen"},{en:"Sign in",fi:"Kirjaudu sisään",sv:"Logga in",de:"Log in"},{en:"Sign in and curate your own art scene",fi:"Kirjaudu sisään ja kuratoi oma sisältösi",sv:"Logga in och ordna din egen konstscen",de:"Log in und kuratieren Sie Ihre eigene Kunstszene"},{en:"Sign out",fi:"Kirjaudu ulos",sv:"Logga ut",de:"Abmelden"},{en:"Site specific art",fi:"Paikkasidonnainen taide",sv:"Platsspecifik konst",de:"Ortsspezifische Kunst"},{en:"Sound art",fi:"Äänitaide",sv:"Ljudkonst",de:"Klangkunst"},{en:"Special time",fi:"Muut aukioloajat",sv:"Speciella tider",de:"Sonderzeiten"},{en:"Specific genre (photography, design etc)",fi:"Taiteenlajiin erikoistunut (valokuva, design jne)",sv:"Specialicerad på konstform (fotografi, design, etc.)",de:"Genre (Fotografie, Design etc.)"},{en:"Street",fi:"Katu",sv:"Gata",de:"Strasse"},{en:"Street art",fi:"Katutaide",sv:"Gatukonst",de:"Street Art"},{en:"Subject",fi:"Aihe",sv:"Ämne",de:"Inhalt/Thema"},{en:"Suggestions",fi:"Ehdotukset",sv:"Förslag",de:"Vorschläge"},{en:"Sun",fi:"Su",sv:"Sön",de:"So"},{en:"Sunday",fi:"Sunnuntai",sv:"Söndag",de:"Sonntag"},{en:"Terms of Service and Privacy Policy",fi:"käyttöehdot ja tietosuojakäytännöt",sv:"villkor och vår sekretesspolicy",de:"Servicebedingungen sowie unserer Datenschutzerklärung einverstanden."},{en:"Textile art",fi:"Tekstiilitaide",sv:"Textilkonst",de:"Textilkunst"},{en:"Thurs",fi:"To",sv:"Tors",de:"Do"},{en:"Thursday",fi:"Torstai",sv:"Torsdag",de:"Donnerstag"},{en:"Title",fi:"Otsikko",sv:"Rubrik",de:"Titel"},{en:"Today",fi:"Tänään",sv:"Idag",de:"Heute"},{en:"Top searches",fi:"Suosituimmat haut",sv:"Populäraste sökningar",de:"Beliebte Suchanfragen"},{en:"Tue",fi:"Ti",sv:"Tis",de:"Di"},{en:"Tuesday",fi:"Tiistai",sv:"Tisdag",de:"Dienstag"},{en:"Type artist name",fi:"Taiteilijan nimi",sv:"Konstnärens namn",de:"Name des Künstlers"},{en:"Type comment",fi:"Lisää merkintä",sv:"Kommentera",de:"Bemerkungen"},{en:"Type one email per line",fi:"Kirjoita yksi sähköpostiosoite per rivi",sv:"Skriv en e-post adress per rad",de:"Eine E-Mail-Adresse pro Zeile eingeben"},{en:"Type your email address below. We will send you an instruction on how to reset your password",fi:"Kirjoita sähköpostiosoitteesi alle. Lähetämme sinulle ohjeet kuinka voit luoda itsellesi uuden salasanan.",sv:"Skriv din e-post. Vi skickar instruktioner för återställandet av ditt lösenord.",de:"E-Mail-Adresse bitte unten eingeben. Wir werden dann weitere Anweisungen zum Zurücksetzen des Passwortes senden."},{en:"Type your friend's email address below and we'll send them an invitation",fi:"Kirjoita ystäviesi sähköpostiosoitteet alle niin lähetämme heille kutsut",sv:"Skriv dina vänners e-post adresser nedan, så skickar vi dem en inbjudan",de:"Gib die E-Mail Adresse eines Freundes ein, um eine Einladung zu schicken"},{en:"URL",fi:"URL",sv:"URL",de:"URL"},{en:"Use as guest",fi:"Kirjaudu vierailijana",sv:"Använd som gäst",de:"als Gast benutzen"},{en:"Username successfully changed",fi:"Käyttäjätunnus onnistuneesti vaihdettu",sv:"Username successfully changed",de:"Username successfully changed"},{en:"Username taken",fi:"Käyttäjätunnus on jo olemassa",sv:"Användarnamnet finns redan",de:"Der Benutzername wird schon verwendet"},{en:"Venue",fi:"Paikka",sv:"Lokal",de:"Veranstaltungsort"},{en:"Venue address",fi:"Osoite",sv:"Adress för plats",de:"Adresse des Veranstaltungsortes"},{en:"Venue city",fi:"Kaupunki",sv:"Stad",de:"Stadt in der die Veranstaltung stattfindet"},{en:"Venue description",fi:"Kuvaus",sv:"Beskrivning av plats",de:"Veranstaltungsort Beschreibung"},{en:"Venue name",fi:"Nimi",sv:"Namn på plats",de:"Name des Veranstaltungsortes"},{en:"Venue successfully created",fi:"Paikka onnistuneesti luotu",sv:"Platsen skapad lyckat",de:"Der Veranstaltungsort wurde erfolgreich erstellt"},{en:"Venue type (museum, gallery, public space, other)",fi:"Tyyppi (museo, galleria, julkinen tila, muu)",sv:"Typ av plats (museum, galleri, allmän plats, annan)",de:"Typ des Veranstaltungsortes"},{en:"Venues",fi:"Paikat",sv:"Lokaler",de:"Verastaltungsortes"},{en:"Video art",fi:"Videotaide",sv:"Videokonst",de:"Videokunst"},{en:"Web",fi:"Web",sv:"Webb",de:"Webseite"},{en:"Website",fi:"www-sivut",sv:"Webbsida",de:"Website"},{en:"Wed",fi:"Ke",sv:"Ons",de:"Mi"},{en:"Wednesday",fi:"Keskiviikko",sv:"Onsdag",de:"Mittwoch"},{en:"When?",fi:"Koska?",sv:"När",de:"Wann?"},{en:"Where?",fi:"Missä?",sv:"Var",de:"Wo?"},{en:"Written in media",fi:"Mediassa",sv:"Skrivet om i media",de:"In Medien geschrieben"},{en:"You are now being redirected to the event page in (%%) second(s)",fi:"siirryt automaattisesti luomasi tapahtuman sivulle muutaman sekunnin kuluttua",sv:"Du flyttas automatiskt till sidan för evenemanget du skapat om några sekunder",de:"Sie werden jetzt automatisch zur Veranstaltungsseite weitergeleitet in (%%) Sekunde(n)"},{en:"You are now being redirected to the venue page in (%%) second(s)",fi:"Siirryt automaattisesti luomasi paikan sivulle muutaman sekunnin kuluttua",sv:"Du flyttas automatiskt till sidan för platsen du skapat om några sekunder",de:"Sie werden jetzt automatisch zur Veranstaltungsseite weitergeleitet in (%%) Sekunde(n)"},{en:"Your email address",fi:"Sähköpostiosoitteesi",sv:"Din e-postadress",de:"E-Mail-Adresse eingeben"},{en:"Your invitation has been sent. Thank you",fi:"Kutsusi on nyt lähetetty. Kiitos!",sv:"Dina inbjudningar har skickats. Tack!",de:"Die Einladung wurde gesendet. Danke!"},{en:"Your previous saved searches",fi:"Aiemmat tallennetut haut",sv:"Dina tidiagre sparade sökningar",de:"Gespeicherte, frühere Suchen"},{en:"Your previous searches",fi:"Viimeaikaiset haut",sv:"Dina tidigare sökningar",de:"Ihre vorherigen Suchanfragen"},{en:"admission fee",fi:"Sisäänpääsymaksu",sv:"Inträdesavgift",de:"Aufnahmegebühr"},{en:"always open",fi:"always open",sv:"always open",de:"always open"},{en:"and curate your own art scene",fi:"ja järjestä oma taidekokoelmasi",sv:"och ordna din egen konstscen",de:"und kuratieren Sie Ihre eigene Kunstszene"},{en:"art genre(s)",fi:"Taidelajit",sv:"Konstgenre",de:"Repräsentiertes Kunstgenre"},{en:"art genre(s) represented",fi:"Edustetut taidelajit",sv:"Konstgenre",de:"Kunstgenre"},{en:"art lover",fi:"Taiteen ystävä",sv:"Konstvän",de:"Kunstfreund"},{en:"artist",fi:"Taiteilijja",sv:"Konstnär",de:"Künstler"},{en:"artist(s)",fi:"Taiteilija(t)",sv:"Konstnär/konstnärer",de:"Artist"},{en:"cancel",fi:"Peru",sv:"Avsluta",de:"Löschen"},{en:"ceramic art",fi:"keramiikka",sv:"keramik",de:"keramik-kunst"},{en:"collage",fi:"kollaasi",sv:"kollage",de:"collage"},{en:"comics",fi:"sarjakuvataide",sv:"seriekonst",de:"comics"},{en:"dates",fi:"Päivämäärä",sv:"Datum",de:"Datum"},{en:"digital art",fi:"digitaalinen taide",sv:"digital konst",de:"digital art"},{en:"drawing",fi:"piirrustus",sv:"teckning",de:"zeichnung"},{en:"e-mail",fi:"sähköposti",sv:"E-post",de:"E-Mail"},{en:"event description",fi:"Tapahtuman kuvaus",sv:"Beskrivning av evenemang",de:"Veranstaltungsbeschreibung"},{en:"event name",fi:"Tapahtuman nimi",sv:"Namn på evenemang",de:"Name des Veranstaltung"},{en:"event organizer (eg gallery, museum, art festval)",fi:"Tapahtumajärjestäjä (esim. galleria, museo, taidefestivaali)",sv:"Arrangör (t.ex. galleri, museum, konstfestival)",de:"Organisator (z.B. Galerie, Museum, Kunstfestival)"},{en:"film",fi:"elokuva",sv:"film",de:"film"},{en:"first name",fi:"Etunimi",sv:"Förnamn",de:"Vorname"},{en:"free admission",fi:"Ilmainen",sv:"Fri entré",de:"Freier Eintritt"},{en:"games",fi:"pelit",sv:"spel",de:"spiele"},{en:"glass art",fi:"lasitaide",sv:"glaskonst",de:"glaskunst"},{en:"illustration",fi:"kuvitus",sv:"illustration",de:"illustration"},{en:"installation art",fi:"installaatiotaide",sv:"installationskonst",de:"installationskunst"},{en:"land art",fi:"maataide",sv:"jordkonst",de:"land-art"},{en:"last chance",fi:"Vielä ehdit",sv:"Sista chansen",de:"Letzte Chance"},{en:"last name",fi:"Sukunimi",sv:"Efternamn",de:"Nachname"},{en:"latest events",fi:"Uusimmat tapahtumat",sv:"Senaste evenemang",de:"Neuste Veranstaltungen"},{en:"light art",fi:"valotaide",sv:"light art",de:"light art"},{en:"load images",fi:"Lataa kuvia",sv:"Ladda bilder",de:"Bilder laden"},{en:"media art",fi:"mediataide",sv:"mediekonst",de:"medienkunst"},{en:"museum",fi:"Museo",sv:"Museum",de:"Museum"},{en:"opening hours",fi:"Aukioloajat",sv:"Öppettider",de:"Öffungzeiten"},{en:"other",fi:"muut",sv:"annat",de:"sonstige"},{en:"painting",fi:"maalaustaide",sv:"måleri",de:"malerei"},{en:"password",fi:"Salasana",sv:"Lösenord",de:"Passwort"},{en:"password again",fi:"Salasana uudelleen",sv:"Skriv in lösenordet igen",de:"Passwort erneut eingeben"},{en:"performance art",fi:"performanssitaide",sv:"performanskonst",de:"performance-kunst"},{en:"phone number",fi:"Puhelin",sv:"Telefonnummer",de:"Telefonnummer"},{en:"photography",fi:"valokuvataide",sv:"fotografi",de:"fotografie"},{en:"popular",fi:"Suosittu",sv:"Populärt",de:"Beliebt"},{en:"printmaking",fi:"taidegrafiikka",sv:"konstgrafik",de:"druckgrafik"},{en:"profile type",fi:"Profiilityyppi",sv:"Profiltyp",de:"Profiltyp"},{en:"public space",fi:"Julkinen tila",sv:"Allmän plats",de:"Öffentliches Gelände"},{en:"same as above but with already existing information",fi:"same as above but with already existing information",sv:"same as above but with already existing information",de:"same as above but with already existing information"},{en:"sculpture",fi:"kuvanveisto",sv:"skulptur",de:"skulptur"},{en:"search a city",fi:"Etsi kaupunkia",sv:"Sök på stad",de:"Stadt auswählen"},{en:"search events, artists, genres…",fi:"Etsi tapahtumia, taiteilijoita, taidelajeja",sv:"Sök evenemang, artister, genrer",de:"Suche Veranstaltungen, artist, Genres ..."},{en:"see text content on separate doc",fi:"see text content on separate doc",sv:"see text content on separate doc",de:"see text content on separate doc"},{en:"site specific art",fi:"paikkasidonnainen taide",sv:"platsspecifik konst",de:"ortsspezifische kunst"},{en:"sound art",fi:"äänitaide",sv:"sound art",de:"sound art"},{en:"street art",fi:"katutaide",sv:"gatukonst",de:"street art"},{en:"textile art",fi:"tekstiilitaide",sv:"textilkonst",de:"textilkunst"},{en:"venue",fi:"Paikka",sv:"Lokal",de:"Veranstaltungsort"},{en:"venue address",fi:"Osoite",sv:"Adress för lokal",de:"Veranstaltungsort adresse"},{en:"venue description",fi:"Kuvaus",sv:"Beskrivning av lokal",de:"Veranstaltungsort Beschreibung"},{en:"venue name",fi:"Nimi",sv:"Namn på lokal",de:"Veranstaltungsort name"},{en:"venue type (museum, gallery, public space, other)",fi:"Tyyppi",sv:"Typ av lokal (museum, galleri, allmän plats, annan)",de:"Veranstaltungsort typ"},{en:"video art",fi:"videotaide",sv:"videokonst",de:"videokunst"},{en:"website",fi:"www-sivut",sv:"Webbsida",de:"Website"},{en:"written in media",fi:"Mediassa",sv:"Skrivet om i media",de:"in Medien geschrieben"},{en:"Page not found",fi:"Sivua ei löydetty",sv:"Sidan hittas inte",de:"Seite nicht gefunden"},{en:"The page you are looking for does not exist or may have been removed",fi:"Sivu etsit ei ole olemassa tai se on poistettu",sv:"Sidan du söker finns inte eller kan ha tagits bort",de:"Die Seite, die Sie suchen existiert nicht oder wurde möglicherweise entfernt"},{en:"Continue to home page",fi:"Jatka kotisivu",sv:"Fortsätt till startsidan",de:"Weiter zur Homepage"},{en:"Network error",fi:"Verkkovirhe",sv:"Netverksfel",de:"Netzwerkfehler"},{en:"No location available",fi:"Sijaintia ei ole saatavilla",sv:"Ingen plats tillgänglig",de:"Kein Standort verfügbar"},{en:"No events",fi:"Ei tapahtumia",sv:"Inga evenemang",de:"Keine Veranstaltungen"}],e=d.length,f=function(){return d.length=e,c.get("location/translations",{model:"city"}).then(function(a){return(a.data||[]).forEach(function(a){d.push(a)}),a.data||[]})};return f(),a.$on("updateTranslation",f),a.$on("updateCities",f),d}]),angular.module("main").filter("link",[function(){return function(a){if(!a)return a;var b="http";return a.toLowerCase().substr(0,b.length)!==b&&(a=b+"://"+a),a}}]),angular.module("main").filter("lang",langFilter),langFilter.$inject=["translations","LangSvc"],angular.module("main").filter("money",[function(){return function(a){return a||(a="Free"),a}}]),angular.module("main").filter("time",[function(){return function(a){if(!a)return"";for(;a.length<4;)a="0"+a;return a.substr(0,2)+":"+a.substr(2)}}]),angular.module("main").filter("distance",["location",function(a){return function(b){var c=a.distance(b);return a.format(c)}}]),angular.module("main").filter("openinghours",["moment","$window","$filter",function(a,b,c){return function(b){if(b&&b.openByAppointment)return"Open by appointment only";if(b&&b.openingHours&&(b=b.openingHours),!b||!b.length)return"";var d=a(),e=(d.isoWeekday()-1,["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]),f={},g=function(a,b){a=parseInt(a),b=parseInt(b);var d=a%100||b%100;return d?c("time")(a+"")+" - "+c("time")(b+""):a/100+" - "+b/100};for(var h in b){var i=e[b[h].day];if("undefined"==typeof f[i]&&(f[i]={day:i,ranges:[]}),b[h].hours)for(var j in b[h].hours){var k=b[h].hours[j];k.start&&k.end&&f[i].ranges.push(g(k.start,k.end))}}var l=function(a){return a.length?a.join(", "):"closed"},m=[];for(var n in e){var o=f[e[n]];o.schedule=l(o.ranges),m.push(o)}for(var p=[],q=m[0],r=m[0],s=function(){return q.day!==r.day?q.day.substr(0,3)+" - "+r.day.substr(0,3)+" "+q.schedule:q.day+"s "+q.schedule},t=1;t<m.length;t++){var u=m[t];u.schedule!==q.schedule&&(p.push(s()),q=u),r=u,t===m.length-1&&p.push(s())}return p.join(", ")}}]),angular.module("main").filter("openstatus",["moment","$window","$filter",function(a,b,c){return function(b){if(b&&b.openByAppointment)return"Open by appointment only";var d=function(a,b){a=parseInt(a),b=parseInt(b);var d=c("time")(a+"")+" to "+c("time")(b+"");return d},e=function(a){var b=[];for(var c in a)a[c].start&&a[c].end&&b.push("from "+d(a[c].start,a[c].end));var e="";for(var f in b)f=parseInt(f),f>0&&(e+=b.length>2?", ":" ",f===b.length-1&&(e+="and ")),e+=b[f];return e},f=a(),g=f.isoWeekday()-1;if(b.specialHours)for(var h in b.specialHours){var i=b.specialHours[h];if(i.startHour&&i.endHour&&a(i.date,"DD.MM.YYYY").format("YYYYMMDD")===f.format("YYYYMMDD"))return"Open today on special hours from "+d(i.startHour,i.endHour)}if(b.openingHours)for(var j in b.openingHours){var k=b.openingHours[j];if(k.day===g){var l=e(k.hours);if(!l)continue;return"Open today "+l}}return"Closed today"}}]),angular.module("main").filter("escape",[function(){var a=function(a){return(a+"").replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")};return function(b){return a(b)}}]),angular.module("main").filter("plainToHtml",["$sce",function(a){return function(b){if(!b)return"";var c=[],d=b.split("\n");for(var e in d){var f=d[e].trim();f?(f=f.replace(/(http|ftp|https):\/\/([\w\-_]+(?:(?:\.[\w\-_]+)+))([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/g,function(a){var b=a.indexOf("://");return'<a href="'+a+'" target="_blank">'+a.substr(b+3)+"</a>"}),c.push(f)):c.push("")}return a.trustAsHtml("<p>"+c.join("<br />")+"</p>")}}]),angular.module("main").filter("break",["$sce",function(a){return function(b,c){"undefined"==typeof c&&(c=1);for(var d=b.split(" "),e=[],f=[],g=0;g<c;g++)e.push(d[g]);for(var h=c;h<d.length;h++)f.push(d[h]);var i=e.join(" ");return f.length&&(i+="<br />"+f.join(" ")),a.trustAsHtml(i)}}]),angular.module("main").filter("thumb",[function(){return function(a,b){if(!a)return a;b=(b||100)+"";var c=a.split("/");"images"===c[0]?c=["","uploads"].concat(c):c[0]||"images"!==c[1]||c.splice(1,0,"uploads"),c.splice(c.length-1,0,"thumbs",b);var d=c.join("/");return d}}]),angular.module("main").directive("gmap",["uiGmapGoogleMapApi","$timeout",function(a,b){var c=null,d=!1,e={},f=function(f,g){a.then(function(a){var h=angular.element.extend({},f.options);f.latitude&&f.longitude&&(h.center=new a.LatLng(f.latitude,f.longitude)),f.zoom&&(h.zoom=f.zoom),f.responsive&&(d=!!f.responsive),c=new a.Map(g.find("div:first")[0],h),a.event.addListener(c,"center_changed",function(){f.change&&f.change(c),b(function(){var a=c.getCenter();f.latitude=a.lat(),f.longitude=a.lng(),f.zoom=c.getZoom()},1)}),d&&(a.event.addDomListener(window,"resize",function(){c.setCenter(e)}),a.event.addListener(c,"idle",function(){e=c.getCenter()})),a.event.addListener(c,"tilesloaded",function(){f.loaded&&f.loaded(c)}),f.init&&f.init(a,c)})};return{link:f,scope:{options:"=",latitude:"=",longitude:"=",zoom:"=",init:"=",loaded:"=",change:"=",responsive:"@"},restrict:"E",template:"<div></div>"}}]),angular.module("main").factory("MapOptions",[function(){return{disableDefaultUI:!0,styles:[{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#000000"},{lightness:40}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#000000"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"landscape",elementType:"geometry",stylers:[{lightness:20}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#161616"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#000000"},{lightness:21}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#000000"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#000000"},{lightness:16}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#000000"},{lightness:19}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#0f252e"},{lightness:17}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#000000"}]}]}}]),angular.module("main").service("MapResponsive",["uiGmapGoogleMapApi","$timeout",function(a,b){var c={},d=this,e=function(a){return c[a]||(c[a]={currentCenter:{},control:{}}),c[a]};this.setCenter=function(a,b){var c=e(a);return c.currentCenter.latitude=b.latitude,c.currentCenter.longitude=b.longitude,d},this.initialize=function(c,f){var g=e(c);return g.control=f,a.then(function(a){b(function(){var b=g.control.getGMap();a.event.addDomListener(window,"resize",function(){g.currentCenter.latitude&&g.currentCenter.longitude&&b.setCenter(new a.LatLng(g.currentCenter.latitude,g.currentCenter.longitude))}),a.event.addListener(b,"idle",function(){d.setCenter(c,{latitude:b.getCenter().lat(),longitude:b.getCenter().lng()})})},1e3)}),d}}]),angular.module("main").directive("modal",["$timeout","$window",function(a,b){var c=function(a,c,d,e,f){a.items=[],a.item={},a.index=a.index||"id";var g=function(){if(a.items&&a.items.length>0)for(var b in a.items)if(a.items[b][a.index]===a.active)return b;return-1},h=function(){var a=c.find(".wrap:first"),d=angular.element(b).height(),e=a.height();a.css("top",d/2-e/2+"px")},i=function(){var b=g();a.item=b>=0?a.items[b]:{},h()};a.previous=function(){var b=g();b>=0?(b--,b<0&&(b=0),a.active=a.items[b][a.index]):a.active=null},a.next=function(){var b=g();b>=0?(b++,b>=a.items.length&&(b=a.items.length-1),a.active=a.items[b][a.index]):a.active=null},a.close=function(){a.active=null};var j=angular.element("body:first"),k=j.css("overflow");a.$watch("active",function(b,c){b!==c&&(null!==a.active?(j.css({overflow:"hidden"}),i()):j.css({overflow:k}))}),angular.element(b).on("resize",function(){h()}),f(a,function(a,b){c.append(a)})};return{link:c,scope:{items:"=",index:"=",active:"="},restrict:"E",transclude:!0}}]),angular.module("main").directive("share",["$timeout","$window","$state",function(a,b,c){var d=function(a,d,e,f,g){a.target=c.href(c.current.name,c.params,{absolute:!0}),a.close=function(){a.active=!1};var h=function(){var a=d.find(".wrap:first"),c=angular.element(b).height(),e=a.height();a.css("top",c/2-e/2+"px")},i=angular.element("body:first"),j=i.css("overflow");a.$watch("active",function(b,c){b!==c&&(a.active?(i.css({overflow:"hidden"}),h()):i.css({overflow:j}))}),angular.element(b).on("resize",function(){h()}),g(a,function(a,b){d.append(a)})};return{link:d,scope:{active:"="},restrict:"E",transclude:!0}}]),function(){function a(a,b,c,d){function e(a,e,f,g){function h(){e.show(),i(),k=new Sly(l,{horizontal:1,itemNav:"forceCentered",smart:1,activateOn:"click",activateMiddle:1,mouseDragging:1,touchDragging:1,releaseSwing:1,startAt:Number(f.active),scrollBy:1,speed:300,elasticBounds:1,dragHandle:1,dynamicHandle:1,clickBar:1,prev:n,next:o}),k.on("active",j),k.init()}function i(){var a=l.width(),b=Math.ceil(a/3),c=60;l.find("li").removeAttr("style").each(function(){var d=$(this),e=d.width();e<b?d.width(b+c):e>=a?d.width(a):d.width(e+c)})}function j(b,c){m.find(".dot").each(function(a){var b=$(this);a===c?b.addClass("active"):b.removeClass("active")}),a.gotoPageForIndex(c)}var k=null,l=e.find(f.wrapper),m=e.find(".pager"),n=e.find(".prev"),o=e.find(".next");
e.hide(),c.ready(function(){b(function(){h()},200)}),angular.element(window).bind("resize",function(){k&&b(function(){i(),k.reload()},300)}),d.gotoPage=a.gotoPage=function(b){k&&(k.activatePage(b),a.gotoPageForIndex(b))},e.on("$destroy",function(){return k&&(k.destroy(),k=null),a.$destroy()})}return{restrict:"A",link:e}}angular.module("main").directive("slidingMenu",a),a.$inject=["$window","$timeout","$document","$rootScope"]}(),angular.module("main").directive("offline",["$rootScope","$window",function(a,b){var c=function(c,d,e,f,g){c.offline=!1;var h=function(b){a.$broadcast("networkStateChange",b),c.offline=!b};b.Offline.on("up",function(){h(!0)}),b.Offline.on("down",function(){h(!1)}),g(c,function(a,b){d.html(a)})};return{link:c,restrict:"A",transclude:!0}}]),angular.module("main").directive("location",[function(){var a=function(a,b,c,d,e){a.unavailable=!1,e(a,function(c,d){b.html(c),a.$on("error",function(a,b){})})};return{link:a,restrict:"A",transclude:!0}}]),angular.module("main").controller("MenuController",MenuController),MenuController.$inject=["$rootScope","$scope","$state","$element","$window","Middleware","$q","Authentication","$timeout","API","LangSvc"],angular.module("main").controller("FooterController",["$scope","$state","$element","$window",function(a,b,c,d){a.$state=null,a.show=function(){if(!a.$state||!a.$state.name)return!1;var b=["authentication","profile","landing-artview","landing-artcache","landing-now","landing-favorites","landing-lastchance","exhibition","artist"];return b.indexOf(a.$state.name)>=0},a.$on("stateChanged",function(b,c){a.$state=c.toState})}]),angular.module("main").controller("SplashController",SplashController),SplashController.$inject=["$window","$scope","$resource","$state","Authentication","API","$http","LangSvc"],angular.module("main").controller("AuthenticationController",AuthenticationController),AuthenticationController.$inject=["$scope","$location","$http","$state","$stateParams","$element","Authentication","$window","genres","LangSvc"],angular.module("main").controller("FeedbackController",["$window","$element","$scope","$timeout","$resource","$state","$stateParams","Authentication","API",function(a,b,c,d,e,f,g,h,i){c.loggedIn=h.token,c.back=function(){a.history.back()},c.input={},c.response={success:!1,message:""},c.busy=!1,c.submit=function(){return!c.busy&&(c.busy=!0,c.response.success=!0,c.response.message="Sending feedback",void i.post("feedback",c.input).then(function(a){c.busy=!1,c.response.success=a.data.success,c.response.message=a.data.message,a.data.success&&(c.input.subject="",c.input.content="")}))}}]),angular.module("main").controller("ReportController",["$window","$element","$scope","$timeout","$resource","$state","$stateParams","Authentication","API",function(a,b,c,d,e,f,g,h,i){return c.loggedIn=h.token,c.back=function(){a.history.back()},f.params.url?(c.input={url:f.params.url},c.response={success:!1,message:""},c.busy=!1,void(c.submit=function(){return!c.busy&&(c.busy=!0,c.response.success=!0,c.response.message="Sending report",void i.post("report",c.input).then(function(a){c.busy=!1,c.response.success=a.data.success,c.response.message=a.data.message,a.data.success&&(c.input.subject="",c.input.content="",c.back())}))})):(f.go("landing-now"),!1)}]),angular.module("main").controller("InviteController",["$window","$element","$scope","$timeout","$resource","$state","$stateParams","Authentication","API",function(a,b,c,d,e,f,g,h,i){c.back=function(){a.history.back()},c.input={},c.response={success:!1,message:""},c.busy=!1,c.submit=function(){return!c.busy&&(c.busy=!0,c.response.success=!0,c.response.message="Sending invitations",void i.post("invite",c.input).then(function(a){c.busy=!1,c.response.success=a.data.success,c.response.message=a.data.message,a.data.success&&(c.input.emails="")}))}}]),angular.module("main").controller("ForgotPasswordController",["$window","$element","$scope","$timeout","$resource","$state","$stateParams","Authentication","API",function(a,b,c,d,e,f,g,h,i){c.back=function(){a.history.back()},c.email=g.email||"",c.success=!0,c.message="",c.busy=!1,c.request=function(){return angular.element.trim(c.email)?!c.busy&&(c.busy=!0,c.success=!0,c.message="Processing request",void i.post("authenticate/passwordreset",{email:c.email}).then(function(a){c.success=a.data.success,c.message=a.data.message,c.success&&(c.email=""),c.busy=!1})):(c.success=!1,c.message="Email address is required",!1)},g.email&&g.code&&(c.busy=!0,c.success=!0,c.message="Completing password reset",i.post("authenticate/passwordreset",{email:g.email,code:g.code}).then(function(a){c.success=a.data.success,c.message=a.data.message,c.busy=!1}))}]),angular.module("main").controller("SettingsController",SettingsController),SettingsController.$inject=["$window","$location","$element","$scope","$timeout","$resource","$state","Authentication","API","Upload","genres","LangSvc"],angular.module("main").controller("AboutTermsController",["$window","$element","$scope","$timeout","$resource","$state","Authentication","API",function(a,b,c,d,e,f,g,h){c.back=function(){a.history.back()}}]),angular.module("main").controller("PrivacyPolicyController",["$window","$element","$scope","$timeout","$resource","$state","Authentication","API",function(a,b,c,d,e,f,g,h){c.back=function(){a.history.back()}}]),angular.module("main").controller("ProfileController",["$window","$scope","$resource","$state","Authentication","API","moment","$timeout",function(a,b,c,d,e,f,g,h){b.user=null,b.increment=5,b.show={exhibitions:5,artists:5,venues:5,activeExhibitions:0,inactiveExhibitions:0,showingInactive:!1,activate:function(a){b.favorites.active=a,b.show.exhibitions=5,b.show.venues=5},more:function(){var a=b.increment;"exhibitions"===b.favorites.active&&!b.show.showingInactive&&b.show[b.favorites.active]+a>b.show.activeExhibitions&&(a=b.show.activeExhibitions-b.show[b.favorites.active],b.show.showingInactive=!0),b.show[b.favorites.active]+=a},hasMore:function(){return b.user&&b.user.favorites&&b.show[b.favorites.active]<b.user.favorites[b.favorites.active].length}},b.showManaged={exhibitions:5,venues:5,activate:function(a){b.manage.active=a,b.showManaged.exhibitions=5,b.showManaged.venues=5},more:function(){b.showManaged[b.manage.active]+=b.increment},hasMore:function(){return b.user&&b.user[b.manage.active]&&b.showManaged[b.manage.active]<b.user[b.manage.active].length}},b.artCache=a.artCache;var i=function(){var a=[],c=b.user?b.user.hiddenArtCache||[]:[];for(var d in c)a.push(c[d]._id||c[d]);return a};b.hiddenArtCache=function(a){var b=i();for(var c in b)if(a._id===b[c])return!0;return!1},b.toggleArtCache=function(a){var c=i(),d=!b.hiddenArtCache(a);if(d)c.push(a._id);else{var e=c.indexOf(a._id);c.splice(e,1)}f.put("me",{user:{hiddenArtCache:c}}).then(function(a){b.user.hiddenArtCache=a.data.hiddenArtCache,b.$emit("userChanged",b.user)})},b.manage={active:"exhibitions",getSingle:function(a){return a.substr(0,a.length-1)},createNew:function(){d.go(b.manage.getSingle(b.manage.active)+"-create")},getName:function(a){var c=b.manage.getSingle(a);return"exhibition"===c&&(c="event"),c},getTitle:function(a){"exhibitions"===a&&(a="events");var b=a.substr(0,1).toUpperCase()+a.substr(1);return"My "+b},names:["exhibitions","venues"]},b.favorites={active:"exhibitions",getName:function(a){return"exhibitions"===a&&(a="events"),a.substr(0,1).toUpperCase()+a.substr(1)},names:["exhibitions","artists","venues"]},b.venue={unfavorite:function(a){return!!confirm("Are you sure you want to remove the selected venue from your favorites?")&&void f["delete"]("venues/"+a.permalink+"/favorite").then(function(c){for(var d in b.user.favorites.venues)if(b.user.favorites.venues[d]._id===a._id){b.user.favorites.venues.splice(d,1);break}})}},b.exhibition={unfavorite:function(a){return!!confirm("Are you sure you want to remove the selected event from your favorites?")&&void f["delete"]("events/"+a.permalink+"/favorite").then(function(c){for(var d in b.user.favorites.exhibitions)if(b.user.favorites.exhibitions[d]._id===a._id){b.user.favorites.exhibitions.splice(d,1);break}})}},b.getLoggedInUser=function(a){f.get("me/profile").then(function(c){b.user=c.data||null,b.user.favorites||(b.user.favorites={exhibitions:[],artists:[],venues:[]}),a&&a(b.user)})},b.getLoggedInUser(function(a){var c=[],d=[];if(a.favorites.exhibitions)for(var e in a.favorites.exhibitions)a.favorites.exhibitions[e].active?c.push(a.favorites.exhibitions[e]):d.push(a.favorites.exhibitions[e]);b.show.activeExhibitions=c.length,b.show.inactiveExhibitions=d.length,a.favorites.exhibitions=c.concat(d)})}]),angular.module("main").controller("EditArtCacheController",["$scope","$resource","$state","$window","Upload","API","moment","$element","$rootScope","$templateCache","$timeout","genres",function(a,b,c,d,e,f,g,h,i,j,k,l){if(a.today=g(),a.admin=d.admin,!a.admin)return c.go("exhibition-create"),!1;a.redirect=null;var m=[{day:0,hours:[{start:"",end:""}]},{day:1,hours:[{start:"1100",end:"1700"}]},{day:2,hours:[{start:"1100",end:"1700"}]},{day:3,hours:[{start:"1100",end:"1700"}]},{day:4,hours:[{start:"1100",end:"1700"}]},{day:5,hours:[{start:"1200",end:"1600"}]},{day:6,hours:[{start:"1200",end:"1600"}]}],n=[{date:"",startHour:"",endHour:""}],o=function(b){for(var c in a.photos)if(a.photos[c].id===b)return c;return-1},p=angular.element;a.removePhoto=function(b){var c=o(b);c>=0&&p("#photo-"+b).fadeTo(200,.01,function(){a.photos.splice(c,1),p(".uploaded .photo").css("opacity",1),a.$$phase||a.$apply()})};a.files=[],a.photos=[];var q=a.photos.length;a.upload=function(b){for(var c in b){var d=b[c];q++,d.uploadId=q,a.photos.push({id:q,loading:!0,full:"",source:""}),e.upload({url:"/api/upload",fields:{},file:d}).progress(function(a){}).success(function(b,c,d,e){var f=o(e.file.uploadId);f>=0&&(a.photos[f].source=b.file.full,p("#photo-"+e.file.uploadId).removeClass("loading"))})}},a.loadExhibition=function(b){f.get("artcache").then(function(c){var d=c.data.data[0];if(a.form.input=d,d.venue&&d.venue._id?a.form.input.venue=[d.venue]:a.form.input.venue=[],a.photos=[],d.gallery&&d.gallery.photos)for(var e in d.gallery.photos){var f=d.gallery.photos[e];a.photos.push({id:f.photo._id,_id:f.photo._id,title:f.photo.title,caption:f.caption,source:f.photo.source,artists:[],nonUserArtists:f.nonUserArtists})}var h=[];for(var i in d.artists){var j=d.artists[i];j.user&&j.user._id?h.push(j.user):(a.form.tagCounter++,h.push({_id:a.form.tagCounter,fullname:j.nonUser.fullname,guest:!0}))}a.form.input.artists=h;var l=g(d.startDate),o=g(d.endDate);a.form.dates.start=l.toDate(),a.form.dates.end=o.toDate(),a.form.input.openingHours&&0!==a.form.input.openingHours.length||(a.form.input.openingHours=m.slice(0)),a.loadedOpeningHours=angular.copy(a.form.input.openingHours),a.form.input.specialHours&&0!==a.form.input.specialHours.length||(a.form.input.specialHours=n.slice(0)),a.form.input.links&&a.form.input.links.length||(a.form.input.links=[{title:"",url:""}]),b&&b(d),k(function(){a.toggleDates(!!a.form.input.openByAppointment)},200)})},a.days=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],a.hours=[""];for(var r=0;r<=23;r++){var s=r?(r<10?"0":"")+r:"00";a.hours.push(s+"00"),a.hours.push(s+"30")}a.addHoursRange=function(b){if(a.singleDay())return!1;if(a.disableDates)return!1;var c=a.form.input.openingHours[b].hours[a.form.input.openingHours[b].hours.length-1];a.form.input.openingHours[b].hours.push({start:c.end,end:c.end})},a.removeHoursRange=function(b,c){if(a.singleDay())return!1;if(a.disableDates)return!1;var d=a.form.input.openingHours[b].hours.length<=1;a.form.input.openingHours[b].hours.splice(c,1),d&&a.form.input.openingHours[b].hours.push({start:"",end:""})},a.closeOn=function(b){return!a.disableDates&&void(a.form.input.openingHours[b].hours=[{start:"",end:""}])},a.isClosedOn=function(b){var c=a.form.input.openingHours[b];return 1===c.hours.length&&!c.hours[0].start&&!c.hours[0].end},a.toggleOpenWholeDayOn=function(b){if(a.isOpenWholeDayOn(b)){var c=a.loadedOpeningHours[b].hours,d=m[b].hours[0],e=a.form.input.openingHours[b].hours;angular.forEach(e,function(a,b){_.isEmpty(c[b])?(a.start=d.start,a.end=d.end):(a.start=c[b].start,a.end=c[b].end)})}else a.form.input.openingHours[b].hours=[{start:a.hours[1],end:_.last(a.hours)}]},a.isOpenWholeDayOn=function(b){var c=a.form.input.openingHours[b];return 1===c.hours.length&&c.hours[0].start===a.hours[1]&&c.hours[0].end===_.last(a.hours)},a.toggleAppointment=function(){a.form.input.openByAppointment=!a.form.input.openByAppointment,a.toggleDates(a.form.input.openByAppointment)},a.isAlwaysOpen=!1,a.disableDates=!1,a.toggleAlwaysOpen=function(){a.isAlwaysOpen?(a.isAlwaysOpen=!1,angular.forEach(a.form.input.openingHours,function(b,c){var d=a.loadedOpeningHours[c].hours,e=m[c].hours[0];angular.forEach(b.hours,function(a,b){d[b]?(a.start=d[b].start,a.end=d[b].end):(a.start=e.start,a.end=e.end)})})):(a.isAlwaysOpen=!0,angular.forEach(a.form.input.openingHours,function(b){angular.forEach(b.hours,function(b){b.start=a.hours[1],b.end=_.last(a.hours)})})),a.toggleDates(a.isAlwaysOpen)},a.addSpecial=function(){return!a.disableDates&&void a.form.input.specialHours.push({date:"",startHour:"",endHour:""})},a.removeSpecial=function(b){if(a.disableDates)return!1;var c=a.form.input.specialHours.length<=1;a.form.input.specialHours.splice(b,1),c&&a.addSpecial()},a.toggleDates=function(b){b?angular.element(".day.group.regular, .day.group.special").each(function(){angular.element(this).find("input, select, textarea").each(function(){angular.element(this).attr("disabled","disabled").addClass("disabled")})}):angular.element(".day.group.regular, .day.group.special").each(function(){angular.element(this).find("input, select, textarea").each(function(){angular.element(this).removeAttr("disabled").removeClass("disabled")})}),a.disableDates=a.form.input.openByAppointment||a.isAlwaysOpen},a.hasOneSpecialDate=function(){for(var b in a.form.input.specialHours)if(a.form.input.specialHours[b]&&a.form.input.specialHours[b].date&&a.form.input.specialHours[b].startHour&&a.form.input.specialHours[b].endHour)return!0;return!1},a.hasSpecial=function(){return a.hasOneSpecialDate()},a.$watch("hasSpecial()",function(b,c){b!==c&&a.toggleDates(b)}),a.form={genreActive:function(a){return this.input.genres.indexOf(a)>=0},genres:l,loadArtists:function(a){return f.get("artists",{q:a,"return":"data"})},tagCounter:0,tagAdded:function(b){a.form.tagCounter++,b._id||(b._id=a.form.tagCounter,b.guest=!0)},loadVenues:function(a){return f.get("venues",{q:a,"return":"data"})},input:{genres:[],artists:[],venue:[],openingHours:[],specialHours:[]},dates:{start:a.today.clone().toDate(),end:a.today.clone().add(5,"days").toDate()},response:{},submit:function(){var b=this;b.input.photos=a.photos,this.response.message="",f.put("artcache/"+b.input._id,b.input).then(function(c){b.response=c.data,b.response.success&&f.get("artcache").then(function(b){d.artCache=b.data.data,a.redirect=["landing-artcache"]})})}},a.loadExhibition();var t=h.find("tags-input:first");a.$watch(function(){return t.attr("class")},function(a,b){t.hasClass("ng-invalid")&&i.$broadcast("openPopup","venueDoesNotExist")}),a.focusVenue=function(){h.find("tags-input:first input:last").focus().select()};var u=h.find(".input.dates [date-range]:first");a.$on("setDate",function(a,b){if("object"==typeof a.targetScope.$parent.start&&"object"==typeof a.targetScope.$parent.end&&a.targetScope.date&&(a.targetScope.$$prevSibling||a.targetScope.$$nextSibling)&&!a.targetScope.$$prevSibling&&a.targetScope.$$nextSibling){var c=a.targetScope.date,d=a.targetScope.$$nextSibling.date,e=c.getMonth(),f=d.getMonth();e!==f&&(d.setYear(c.getFullYear()),d.setMonth(e))}}),j.put("templates/daterange.html",'<div class="date-range-wrap"><div class="date-picker-wrap"><h4>{{ \'Opening\' | lang }}</h4><div date-picker="start" ng-disabled="disableDatePickers" class="date-picker start" date after="start" before="end" min-view="date" max-view="date"></div></div><div class="date-picker-wrap"><h4>{{ \'Closing\' | lang }}</h4><div date-picker="end" ng-disabled="disableDatePickers" class="date-picker end" date after="start" before="end" min-view="date" max-view="date"></div></div></div>'),a.showDatepicker=function(){u.fadeIn(200)},a.hideDatepicker=function(){u.fadeOut(200),a.specialDateIndex=-1},a.$watchCollection("[form.dates.start, form.dates.end]",function(b,c){var d=g(a.form.dates.start),e=g(a.form.dates.end);a.form.input.dates=d.format("DD.MM.YYYY")+"-"+e.format("DD.MM.YYYY")}),a.addLink=function(){a.form.input.links.push({title:"",url:""})},a.removeLink=function(b){a.form.input.links.splice(b,1)},a.prefillEvent=function(){a.form.input.admissionFee=a.form.input.venue[0].admissionFee,a.form.input.openingHours=angular.copy(a.form.input.venue[0].openingHours)},h.on("keydown",'input.date, .input.dates:first input[name="dates"]',function(){return!1}),a.specialDateIndex=-1,a.specialDateFocused=function(b){a.specialDateIndex=b},a.singleDay=function(){return a.form.dates.start.toString()===a.form.dates.end.toString()},a.$watch("singleDay()",function(b,c){b!==c&&a.toggleDates(b)})}]),angular.module("main").controller("ArtViewController",ArtViewController),ArtViewController.$inject=["$scope","$resource","$document","API","$window","$timeout"],angular.module("main").controller("ArtCacheController",ArtCacheController),ArtCacheController.$inject=["$window","$scope","API","$state","MapOptions","uiGmapGoogleMapApi","MapResponsive","$timeout","Authentication"],angular.module("main").controller("NowController",NowController),NowController.$inject=["$rootScope","$scope","$resource","Authentication","API","$state","location"],angular.module("main").controller("FavoritesController",["$rootScope","$scope","$resource","Authentication","API",function(a,b,c,d,e){b.auth=d,b.exhibitions=[],b.current=0,b.limit=10,b.favorite=function(a){var b="events/"+a.permalink+"/favorite",c=a.favorited?e["delete"](b):e.post(b);c.then(function(b){b.data.success&&(a.favorited=!a.favorited)})},b.recommend=function(a){var b="events/"+a.permalink+"/recommend",c=a.recommended?e["delete"](b):e.post(b);c.then(function(b){b.data.success&&(a.recommended=!a.recommended)})},b.ended=!1,b.busy=!1,b.loaded=[],b.loadExhibitions=function(){return!(b.loaded.indexOf(b.current)>=0)&&(b.loaded.push(b.current),void e.get("me/favorites/events",{start:b.current,limit:b.limit}).then(function(c){var d=c.data;d.data.length||(b.ended=!0),d.cities&&a.$broadcast("$activateCities",d.cities||[]);for(var e=0;e<d.data.length;e++){var f=d.data[e],g=[];for(var h in f.artists)g.push(f.artists[h].user?f.artists[h].user.fullname:f.artists[h].nonUser.fullname);b.exhibitions.push({name:f.name,permalink:f.permalink,artists:g,date:{start:f.startDate,end:f.endDate},address:{city:f.venue.address.city,lang:f.venue.address.lang,full:f.venue.address.line1||"",coordinates:f.venue.address.coordinates||{},distance:"250m"},venue:f.venue,image:{dimensions:{width:f.gallery.photos[0].photo.width,height:f.gallery.photos[0].photo.height},thumb:"",medium:root+f.gallery.photos[0].photo.source,large:""},open:"Open today from 12 to 18",openingHours:f.openingHours,specialHours:f.specialHours,favorited:f.favorite,recommended:f.recommend}),b.current++}b.limit=3,b.busy=!1}))},b.brickHeight=function(a){var b=0;switch(device){case"extraLargeDesktop":b=296;break;case"largeDesktop":b=326;break;case"desktop":b=339;break;case"tablet":b=328;break;case"mobile":b=270}var c=a.dimensions.width/a.dimensions.height;return b/c}}]),angular.module("main").controller("LastChanceController",["$rootScope","$scope","$resource","Authentication","API",function(a,b,c,d,e){b.auth=d,b.exhibitions=[],b.current=0,b.limit=10,b.favorite=function(a){var b="events/"+a.permalink+"/favorite",c=a.favorited?e["delete"](b):e.post(b);c.then(function(b){b.data.success&&(a.favorited=!a.favorited)})},b.recommend=function(a){var b="events/"+a.permalink+"/recommend",c=a.recommended?e["delete"](b):e.post(b);c.then(function(b){b.data.success&&(a.recommended=!a.recommended)})},b.ended=!1,b.busy=!1,b.loaded=[],b.restart=function(){return b.loaded.length=0,b.ended=!1,b.exhibitions=[],b.current=0,b.loadExhibitions()},b.loadExhibitions=function(){if(b.loaded.indexOf(b.current)>=0||!a.$currentCity)return!1;b.loaded.push(b.current);var c={start:b.current,limit:b.limit,landing:"lastchance",sort:"-recommended",city:a.$currentCity.lcase};e.get("events",c).then(function(c){var d=c.data;d.data.length||(b.ended=!0),d.cities&&a.$broadcast("$activateCities",d.cities||[]);for(var e=0;e<d.data.length;e++){var f=d.data[e],g=[];for(var h in f.artists)g.push(f.artists[h].user?f.artists[h].user.fullname:f.artists[h].nonUser.fullname);b.exhibitions.push({name:f.name,permalink:f.permalink,artists:g,date:{start:f.startDate,end:f.endDate},address:{full:f.venue.address.line1||"",coordinates:f.venue.address.coordinates||{},distance:"250m"},venue:f.venue,image:{dimensions:{width:f.gallery.photos[0].photo.width,height:f.gallery.photos[0].photo.height},thumb:"",medium:root+f.gallery.photos[0].photo.source,large:""},open:"Open today from 12 to 18",openingHours:f.openingHours,specialHours:f.specialHours,favorited:f.favorite,recommended:f.recommend}),b.current++}b.limit=3,b.busy=!1})},b.brickHeight=function(a){var b=0;switch(device){case"extraLargeDesktop":b=296;break;case"largeDesktop":b=326;break;case"desktop":b=339;break;case"tablet":b=328;break;case"mobile":b=270}var c=a.dimensions.width/a.dimensions.height;return b/c},b.$on("$changeCity",b.restart)}]),angular.module("main").controller("VenueController",VenueController),VenueController.$inject=["$rootScope","$window","$timeout","$scope","$resource","$state","MapOptions","API","MapResponsive","Authentication"],angular.module("main").controller("CreateVenueController",["$rootScope","$scope","$resource","$state","$window","Upload","API","MapOptions","uiGmapGoogleMapApi","$timeout","moment","$element",function(a,b,c,d,e,f,g,h,i,j,k,l){b.today=k(),b.files=[],b.photos=[],b.blurs=[],b.blur=function(a){b.blurred(a)||b.blurs.push(a)},b.blurred=function(a){return b.blurs.indexOf(a)>=0},b.addressError="",angular.element("tags-input").each(function(){var a=angular.element(this),c=a.attr("name");a.on("blur","input:text",function(){b.blur(c)})}),b.redirect=null;var m=[{day:0,hours:[{start:"",end:""}]},{day:1,hours:[{start:"1100",end:"1700"}]},{day:2,hours:[{start:"1100",end:"1700"}]},{day:3,hours:[{start:"1100",end:"1700"}]},{day:4,hours:[{start:"1100",end:"1700"}]},{day:5,hours:[{start:"1200",end:"1600"}]},{day:6,hours:[{start:"1200",end:"1600"}]}];b.map={maps:null,geocoder:null,gmap:null,marker:null,options:h,zoom:15,geocodeDelay:null,geocoding:!1,geocode:function(){return!this.geocoding&&(this.geocodeDelay&&j.cancel(this.geocodeDelay),void j(function(){b.map.geocoder.geocode({address:b.map.fullAddress()},function(a,c){c===b.map.maps.GeocoderStatus.OK&&a[0]&&b.map.gmap.setCenter(a[0].geometry.location),b.map.geocoding=!1})},1e3))},init:function(a,c){b.map.maps=a,b.map.gmap=c,b.map.marker=new a.Marker({position:c.getCenter(),map:c,icon:e.location.origin+root+"/images/marker.png"}),b.map.geocoder=new a.Geocoder,b.$watch("form.input.address.line1",function(a,c){b.map.geocode()});var d=!1,f=null;b.$watch("form.input.address.city",function(a,c){a===c||d||(f&&j.cancel(f),f=j(function(){d=!0,g.get("location/city",{name:a}).then(function(a){d=!1,b.addressError="",a.data&&!a.data.success&&a.data.error?b.addressError=a.data.error||"":(b.form.input.address.city=a.data.name,b.form.input.address.country=[a.data.country],b.form.input.address.lang=a.data.lang,b.map.geocode())})},1e3))})},change:function(a){var c=a.getCenter();b.map.marker.setPosition(c)},fullAddress:function(){var a=b.form.input.address.line1+(b.form.input.address.line1?", ":"")+b.form.input.address.city;return a||(a="Helsinki"),a+", Finland"}};var n=[{date:"",startHour:"",endHour:""}],o=function(a){for(var c in b.photos)if(b.photos[c].id===a)return c;return-1},p=angular.element;b.removePhoto=function(a){var c=o(a);c>=0&&p("#photo-"+a).fadeTo(200,.01,function(){b.photos.splice(c,1),p(".uploaded .photo").css("opacity",1),b.$$phase||b.$apply()})};var q=function(){var a=[];for(var c in b.photos)a.push(b.photos[c].source);return a},r=0;b.upload=function(a){for(var c in a){var d=a[c];r++,d.uploadId=r,b.photos.push({id:r,loading:!0,full:"",source:""}),f.upload({url:"/api/upload",fields:{},file:d}).progress(function(a){}).success(function(a,c,d,e){var f=o(e.file.uploadId);f>=0&&(b.photos[f].source=a.file.full,p("#photo-"+e.file.uploadId).removeClass("loading"))})}},b.days=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],b.hours=[""];for(var s=0;s<=23;s++){var t=s?(s<10?"0":"")+s:"00";b.hours.push(t+"00"),b.hours.push(t+"30")}b.hours.push("2359"),b.addHoursRange=function(a){var c=b.form.input.openingHours[a].hours[b.form.input.openingHours[a].hours.length-1];b.form.input.openingHours[a].hours.push({start:c.end,end:c.end})},b.removeHoursRange=function(a,c){var d=b.form.input.openingHours[a].hours.length<=1;b.form.input.openingHours[a].hours.splice(c,1),d&&b.form.input.openingHours[a].hours.push({start:"",end:""})},b.closeSpecial=function(){b.form.input.specialHours=[{date:"",startHour:"",endHour:""}]},b.isClosedSpecial=function(){return 1===b.form.input.specialHours.length&&!b.form.input.specialHours[0].date&&!b.form.input.specialHours[0].start&&!b.form.input.specialHours[0].end},b.closeOn=function(a){b.form.input.openingHours[a].hours=[{start:"",end:""}]},b.isClosedOn=function(a){var c=b.form.input.openingHours[a];return 1===c.hours.length&&!c.hours[0].start&&!c.hours[0].end},b.openWholeDayOn=function(a){b.form.input.openingHours[a].hours=[{start:"0000",end:"2359"}]},b.isOpenWholeDayOn=function(a){var c=b.form.input.openingHours[a];return 1===c.hours.length&&"0000"===c.hours[0].start&&"2359"===c.hours[0].end},b.toggleAppointment=function(){b.form.input.openByAppointment=!b.form.input.openByAppointment,b.toggleDates(b.form.input.openByAppointment)},b.toggleDates=function(a){a?angular.element(".day.group.regular, .day.group.special").each(function(){angular.element(this).find("input, select, textarea").each(function(){angular.element(this).attr("disabled","disabled").addClass("disabled")})}):angular.element(".day.group.regular, .day.group.special").each(function(){angular.element(this).find("input, select, textarea").each(function(){angular.element(this).removeAttr("disabled").removeClass("disabled")})})},b.addSpecial=function(){b.form.input.specialHours.push({date:"",startHour:"",endHour:""})},b.removeSpecial=function(a){b.form.input.specialHours.splice(a,1)},b.$watchCollection("form.input.venueTypes",function(a,c){for(var d in b.form.types){var e=b.form.types[d];if(a.indexOf(e.name)<0&&c.indexOf(e.name)>=0)for(var f=b.form.input.venueTypes.length-1;f>=0;f--){var g=b.form.input.venueTypes[f];g.substr(0,e.name.length)===e.name&&b.form.input.venueTypes.splice(f,1)}}}),b.isMajorVenueType=function(a){for(var c in b.form.types)if(a===b.form.types[c].name)return b.form.types[c];return!1},b.requiredVenueTypes=function(){var a=[];for(var c in b.form.input.venueTypes){var d=b.form.input.venueTypes[c],e=b.isMajorVenueType(d);if(e){var f=!1;for(var g in b.form.input.venueTypes){var h=b.form.input.venueTypes[g];if(h!==d&&h.substr(0,d.length)===d){f=!0;break}}f||a.push("Please choose at least one venue type under "+e.title)}}return a},b.form={types:[{name:"gallery",title:"gallery",sub:[{name:"gallery artist run",title:"artist run"},{name:"gallery contemporary",title:"contemporary"},{name:"gallery commercial",title:"commercial"},{name:"gallery international",title:"international"},{name:"gallery lifestyle",title:"lifestyle"},{name:"gallery modern",title:"modern"},{name:"gallery other",title:"other"}]},{name:"museum",title:"art museum",sub:[{name:"museum contemporary",title:"contemporary"},{name:"museum historical",title:"historical"},{name:"museum modern",title:"modern"},{name:"museum specific genre",title:"specific genre (photography, design, etc.)"},{name:"museum other",title:"other"}]},{name:"public",title:"public space",sub:[{name:"public street",title:"street"},{name:"public building",title:"public building"},{name:"public park",title:"park"},{name:"public forest",title:"forest"},{name:"public other",title:"other"}]},{name:"other",title:"other",sub:[{name:"other artist studio",title:"artist studio"},{name:"other curator studio",title:"curator studio"},{name:"other private house",title:"private house"}]}],typeActive:function(a){return a===b.form.input.venueType},typeIsActive:function(a){return b.form.input.venueTypes.indexOf(a)>=0},admissionFees:[{name:"free",title:"free"},{name:"1-6",title:"1 € – 6 €"},{name:"6-12",title:"6 € – 12 €"},{name:"12–18",title:"12 € –18 €"},{name:"19+",title:"19 € –> €"}],admissionFeeActive:function(a){return a===b.form.input.admissionFee},input:{venueType:"gallery",venueTypes:["gallery"],admissionFee:"free",address:{full:"",city:"",country:[],lang:"en",coordinates:{latitude:60.173324,longitude:24.941025}},openingHours:m.slice(0),specialHours:n.slice(0),links:[{title:"",url:""}]},response:{},loadEntries:function(a,b){return g.get(a,{q:b,"return":"data"})},loadUsers:function(a){return b.form.loadEntries("users/find",a)},loadCountries:function(a){return b.form.loadEntries("location/countries",a)},submit:function(){var c=this;c.input.photos=q(),this.response.message="";var d=b.requiredVenueTypes();d.length?this.response.message=d[0]:g.post("venues",c.input).then(function(d){c.response=d.data,d.data.success&&(b.redirect=["venue",{permalink:d.data.data.permalink}],a.$broadcast("updateCities"))})}},b.addLink=function(){b.form.input.links.push({title:"",url:""})},b.removeLink=function(a){b.form.input.links.splice(a,1)},b.setDefaultUrl=function(){b.form.input.website||(b.form.input.website="http://")},b.removeDefaultUrl=function(){"http://"===b.form.input.website&&(b.form.input.website="")},b.validateEmail=function(){return/.+\@.+\..+/.test(b.form.input.email)},b.isValidCity=function(){return!/\d/.test(b.form.input.address.city)},l.on("keydown","input.date",function(){return!1}),b.specialDateIndex=-1,b.specialDateFocused=function(a){b.specialDateIndex=a},b.hideDatepicker=function(){b.specialDateIndex=-1}}]),angular.module("main").controller("EditVenueController",["$rootScope","$scope","$resource","$state","$window","Upload","API","MapOptions","uiGmapGoogleMapApi","$timeout","moment","$element",function(a,b,c,d,e,f,g,h,i,j,k,l){b.today=k(),b.admin=e.admin,b.files=[],b.photos=[],b.blurs=[],b.blur=function(a){b.blurred(a)||b.blurs.push(a)},b.blurred=function(a){return b.blurs.indexOf(a)>=0},b.addressError="",angular.element("tags-input").each(function(){var a=angular.element(this),c=a.attr("name");a.on("blur","input:text",function(){b.blur(c)})}),b.redirect=null;var m=[{day:0,hours:[{start:"",end:""}]},{day:1,hours:[{start:"1100",end:"1700"}]},{day:2,hours:[{start:"1100",end:"1700"}]},{day:3,hours:[{start:"1100",end:"1700"}]},{day:4,hours:[{start:"1100",end:"1700"}]},{day:5,hours:[{start:"1200",end:"1600"}]},{day:6,hours:[{start:"1200",end:"1600"}]}];b.map={maps:null,geocoder:null,gmap:null,marker:null,options:h,zoom:15,geocodeDelay:null,geocoding:!1,geocode:function(){return!this.geocoding&&(this.geocodeDelay&&j.cancel(this.geocodeDelay),void j(function(){b.map.geocoder.geocode({address:b.map.fullAddress()},function(a,c){c===b.map.maps.GeocoderStatus.OK&&a[0]&&b.map.gmap.setCenter(a[0].geometry.location),b.map.geocoding=!1})},1e3))},init:function(a,c){b.map.maps=a,b.map.gmap=c,b.map.marker=new a.Marker({position:c.getCenter(),map:c,icon:e.location.origin+root+"/images/marker.png"}),b.map.geocoder=new a.Geocoder,b.$watch("form.input.address.line1",function(a,c){a!==c&&b.map.geocode()});var d=!1,f=null;b.$watch("form.input.address.city",function(a,c){a===c||d||(f&&j.cancel(f),f=j(function(){d=!0,g.get("location/city",{name:a}).then(function(a){d=!1,b.addressError="",a.data&&!a.data.success&&a.data.error?b.addressError=a.data.error||"":(b.form.input.address.city=a.data.name,
b.form.input.address.country=[a.data.country],b.form.input.address.lang=a.data.lang,b.map.geocode())})},1e3))})},change:function(a){var c=a.getCenter();b.map.marker.setPosition(c)},fullAddress:function(){var a=b.form.input.address.line1+(b.form.input.address.line1?", ":"")+b.form.input.address.city;return a||(a="Helsinki"),a+", Finland"}};var n=[{date:"",startHour:"",endHour:""}],o=function(a){for(var c in b.photos)if(b.photos[c].id===a)return c;return-1},p=angular.element;b.removePhoto=function(a){var c=o(a);c>=0&&p("#photo-"+a).fadeTo(200,.01,function(){b.photos.splice(c,1),p(".uploaded .photo").css("opacity",1),b.$$phase||b.$apply()})};var q=function(){var a=[];for(var c in b.photos)a.push(b.photos[c].source);return a},r=0;b.upload=function(a){for(var c in a){var d=a[c];r++,d.uploadId=r,b.photos.push({id:r,loading:!0,full:"",source:""}),f.upload({url:"/api/upload",fields:{},file:d}).progress(function(a){}).success(function(a,c,d,e){var f=o(e.file.uploadId);f>=0&&(b.photos[f].source=a.file.full,p("#photo-"+e.file.uploadId).removeClass("loading"))})}},b.confirmDelete=!1,b["delete"]=function(){g["delete"]("venues/"+d.params.permalink).then(function(a){d.go("profile")})},b.activeEvents=[],b.loadVenue=function(a){g.get("venues/"+d.params.permalink).then(function(c){if(!c.data.owned)return d.go("profile"),!1;if(b.form.input=c.data,b.venue=angular.copy(c.data),b.form.input.owner=[c.data.owner],b.form.input.address.country=[c.data.address.country],c.data.exhibitions&&c.data.exhibitions.length)for(var e in c.data.exhibitions)c.data.exhibitions[e].active&&b.activeEvents.push(c.data.exhibitions[e]);b.form.input.openingHours&&0!==b.form.input.openingHours.length||(b.form.input.openingHours=m.slice(0)),b.form.input.specialHours&&0!==b.form.input.specialHours.length||(b.form.input.specialHours=n.slice(0)),b.form.input.links&&b.form.input.links.length||(b.form.input.links=[{title:"",url:""}]),b.photos=c.data.album&&c.data.album.photos?c.data.album.photos:[],a&&a(c.data),j(function(){b.toggleDates(!!b.form.input.openByAppointment)},200)})},b.days=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],b.hours=[""];for(var s=0;s<=23;s++){var t=s?(s<10?"0":"")+s:"00";b.hours.push(t+"00"),b.hours.push(t+"30")}b.hours.push("2359"),b.addHoursRange=function(a){var c=b.form.input.openingHours[a].hours[b.form.input.openingHours[a].hours.length-1];b.form.input.openingHours[a].hours.push({start:c.end,end:c.end})},b.removeHoursRange=function(a,c){var d=b.form.input.openingHours[a].hours.length<=1;b.form.input.openingHours[a].hours.splice(c,1),d&&b.form.input.openingHours[a].hours.push({start:"",end:""})},b.closeSpecial=function(){b.form.input.specialHours=[{date:"",startHour:"",endHour:""}]},b.isClosedSpecial=function(){return 1===b.form.input.specialHours.length&&!b.form.input.specialHours[0].date&&!b.form.input.specialHours[0].start&&!b.form.input.specialHours[0].end},b.closeOn=function(a){b.form.input.openingHours[a].hours=[{start:"",end:""}]},b.isClosedOn=function(a){var c=b.form.input.openingHours[a];return 1===c.hours.length&&!c.hours[0].start&&!c.hours[0].end},b.openWholeDayOn=function(a){b.form.input.openingHours[a].hours=[{start:"0000",end:"2359"}]},b.isOpenWholeDayOn=function(a){var c=b.form.input.openingHours[a];return 1===c.hours.length&&"0000"===c.hours[0].start&&"2359"===c.hours[0].end},b.toggleAppointment=function(){b.form.input.openByAppointment=!b.form.input.openByAppointment,b.toggleDates(b.form.input.openByAppointment)},b.toggleDates=function(a){a?angular.element(".day.group.regular, .day.group.special").each(function(){angular.element(this).find("input, select, textarea").each(function(){angular.element(this).attr("disabled","disabled").addClass("disabled")})}):angular.element(".day.group.regular, .day.group.special").each(function(){angular.element(this).find("input, select, textarea").each(function(){angular.element(this).removeAttr("disabled").removeClass("disabled")})})},b.addSpecial=function(){b.form.input.specialHours.push({date:"",startHour:"",endHour:""})},b.removeSpecial=function(a){b.form.input.specialHours.splice(a,1)},b.$watchCollection("form.input.venueTypes",function(a,c){for(var d in b.form.types){var e=b.form.types[d];if(a.indexOf(e.name)<0&&c.indexOf(e.name)>=0)for(var f=b.form.input.venueTypes.length-1;f>=0;f--){var g=b.form.input.venueTypes[f];g.substr(0,e.name.length)===e.name&&b.form.input.venueTypes.splice(f,1)}}}),b.isMajorVenueType=function(a){for(var c in b.form.types)if(a===b.form.types[c].name)return b.form.types[c];return!1},b.requiredVenueTypes=function(){var a=[];for(var c in b.form.input.venueTypes){var d=b.form.input.venueTypes[c],e=b.isMajorVenueType(d);if(e){var f=!1;for(var g in b.form.input.venueTypes){var h=b.form.input.venueTypes[g];if(h!==d&&h.substr(0,d.length)===d){f=!0;break}}f||a.push("Please choose at least one venue type under "+e.title)}}return a},b.form={types:[{name:"gallery",title:"gallery",sub:[{name:"gallery artist run",title:"artist run"},{name:"gallery contemporary",title:"contemporary"},{name:"gallery commercial",title:"commercial"},{name:"gallery international",title:"international"},{name:"gallery lifestyle",title:"lifestyle"},{name:"gallery modern",title:"modern"},{name:"gallery other",title:"other"}]},{name:"museum",title:"art museum",sub:[{name:"museum contemporary",title:"contemporary"},{name:"museum historical",title:"historical"},{name:"museum modern",title:"modern"},{name:"museum specific genre",title:"specific genre (photography, design, etc.)"},{name:"museum other",title:"other"}]},{name:"public",title:"public space",sub:[{name:"public street",title:"street"},{name:"public building",title:"public building"},{name:"public park",title:"park"},{name:"public forest",title:"forest"},{name:"public other",title:"other"}]},{name:"other",title:"other",sub:[{name:"other artist studio",title:"artist studio"},{name:"other curator studio",title:"curator studio"},{name:"other private house",title:"private house"}]}],typeActive:function(a){return a===b.form.input.venueType},typeIsActive:function(a){return b.form.input.venueTypes.indexOf(a)>=0},admissionFees:[{name:"free",title:"free"},{name:"1-6",title:"1 € – 6 €"},{name:"6-12",title:"6 € – 12 €"},{name:"12-18",title:"12 € – 18 €"},{name:"19+",title:"19 € –> €"}],admissionFeeActive:function(a){return a===b.form.input.admissionFee},input:{owner:[],venueType:"gallery",venueTypes:["gallery"],admissionFee:"free",openingHours:[],specialHours:[]},response:{},loadEntries:function(a,b){return g.get(a,{q:b,"return":"data"})},loadUsers:function(a){return b.form.loadEntries("users/find",a)},loadCountries:function(a){return b.form.loadEntries("location/countries",a)},submit:function(){var c=this;c.input.photos=q(),this.response.message="";var e=b.requiredVenueTypes();e.length?this.response.message=e[0]:g.put("venues/"+d.params.permalink,c.input).then(function(d){c.response=d.data,c.response.success&&(c.response.message="Venue successfully updated",b.redirect=["venue",{permalink:d.data.data.permalink}],a.$broadcast("updateCities"))})}},b.addLink=function(){b.form.input.links.push({title:"",url:""})},b.removeLink=function(a){b.form.input.links.splice(a,1)},b.setDefaultUrl=function(){b.form.input.website||(b.form.input.website="http://")},b.removeDefaultUrl=function(){"http://"===b.form.input.website&&(b.form.input.website="")},b.validateEmail=function(){return/.+\@.+\..+/.test(b.form.input.email)},b.isValidCity=function(){return!/\d/.test(b.form.input.address.city)},l.on("keydown","input.date",function(){return!1}),b.specialDateIndex=-1,b.specialDateFocused=function(a){b.specialDateIndex=a},b.hideDatepicker=function(){b.specialDateIndex=-1},b.loadVenue()}]),angular.module("main").controller("ExhibitionController",ExhibitionController),ExhibitionController.$inject=["$rootScope","$window","$scope","API","$state","MapOptions","MapResponsive","$timeout","location","moment","$interval"],angular.module("main").controller("CreateExhibitionController",CreateExhibitionController),CreateExhibitionController.$inject=["$scope","$element","$rootScope","$resource","$state","$stateParams","$window","Upload","API","moment","$templateCache","$timeout","genres","$q"],angular.module("main").controller("EditExhibitionController",["$scope","$resource","$state","$window","Upload","API","moment","$element","$rootScope","$templateCache","$timeout","genres","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.today=g(),a.admin=d.admin,a.blurs=[],a.blur=function(b){a.blurred(b)||a.blurs.push(b)},a.blurred=function(b){return a.blurs.indexOf(b)>=0},angular.element("tags-input").each(function(){var b=angular.element(this),c=b.attr("name");b.on("blur","input:text",function(){a.blur(c)})}),angular.element("div.uploaded:first").on("blur",".photo tags-input input:text",function(){var b=angular.element(this),c=parseInt(b.parents(".photo:first").attr("index"));a.photos[c].blurred=!0}),a.redirect=null;var n=[{day:0,hours:[{start:"",end:""}]},{day:1,hours:[{start:"1100",end:"1700"}]},{day:2,hours:[{start:"1100",end:"1700"}]},{day:3,hours:[{start:"1100",end:"1700"}]},{day:4,hours:[{start:"1100",end:"1700"}]},{day:5,hours:[{start:"1200",end:"1600"}]},{day:6,hours:[{start:"1200",end:"1600"}]}],o=[{date:"",startHour:"",endHour:""}],p=function(b){for(var c in a.photos)if(a.photos[c].id===b)return c;return-1},q=angular.element;a.removePhoto=function(b){var c=p(b);c>=0&&q("#photo-"+b).fadeTo(200,.01,function(){a.photos.splice(c,1),q(".uploaded .photo").css("opacity",1),a.$$phase||a.$apply()})};a.files=[],a.photos=[];var r=a.photos.length;a.upload=function(b){for(var c in b){var d=b[c];r++,d.uploadId=r,a.photos.push({id:r,loading:!0,full:"",source:""}),e.upload({url:"/api/upload",fields:{},file:d}).progress(function(a){}).success(function(b,c,d,e){var f=p(e.file.uploadId);f>=0&&(a.photos[f].source=b.file.full,a.photos[f].blurred=!1,q("#photo-"+e.file.uploadId).removeClass("loading"))})}},a.loadExhibition=function(b){f.get("events/"+c.params.permalink).then(function(d){if(!d.data.owned)return c.go("profile"),!1;if(a.form.input=d.data,a.form.input.venue=[d.data.venue],a.photos=[],d.data.gallery&&d.data.gallery.photos)for(var e in d.data.gallery.photos){var f=d.data.gallery.photos[e];a.photos.push({id:f.photo._id,_id:f.photo._id,title:f.photo.title,caption:f.caption,source:f.photo.source,artists:f.artists,nonUserArtists:f.nonUserArtists})}var h=[],i=[];for(var j in d.data.artists){var l=d.data.artists[j];l.user&&l.user._id?i.indexOf(l.user._id)<0&&(h.push(l.user),i.push(l.user._id)):(a.form.tagCounter++,h.push({_id:a.form.tagCounter,fullname:l.nonUser.fullname,guest:!0}))}a.form.input.artists=h;var m=g(d.data.startDate),p=g(d.data.endDate);a.form.dates.start=m.toDate(),a.form.dates.end=p.toDate(),a.form.input.openingHours&&0!==a.form.input.openingHours.length||(a.form.input.openingHours=n.slice(0)),a.form.input.specialHours&&0!==a.form.input.specialHours.length||(a.form.input.specialHours=o.slice(0)),a.form.input.links&&a.form.input.links.length||(a.form.input.links=[{title:"",url:""}]),b&&b(d.data),k(function(){a.toggleDates(!!a.form.input.openByAppointment)},200)})},a.days=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],a.hours=[""];for(var s=0;s<=23;s++){var t=s?(s<10?"0":"")+s:"00";a.hours.push(t+"00"),a.hours.push(t+"30")}a.hours.push("2359"),a.addHoursRange=function(b){if(a.singleDay())return!1;var c=a.form.input.openingHours[b].hours[a.form.input.openingHours[b].hours.length-1];a.form.input.openingHours[b].hours.push({start:c.end,end:c.end})},a.removeHoursRange=function(b,c){if(a.singleDay())return!1;var d=a.form.input.openingHours[b].hours.length<=1;a.form.input.openingHours[b].hours.splice(c,1),d&&a.form.input.openingHours[b].hours.push({start:"",end:""})},a.closeOn=function(b){a.form.input.openingHours[b].hours=[{start:"",end:""}]},a.isClosedOn=function(b){var c=a.form.input.openingHours[b];return 1===c.hours.length&&!c.hours[0].start&&!c.hours[0].end},a.openWholeDayOn=function(b){a.form.input.openingHours[b].hours=[{start:"0000",end:"2359"}]},a.isOpenWholeDayOn=function(b){var c=a.form.input.openingHours[b];return 1===c.hours.length&&"0000"===c.hours[0].start&&"2359"===c.hours[0].end},a.toggleAppointment=function(){a.form.input.openByAppointment=!a.form.input.openByAppointment,a.toggleDates(a.form.input.openByAppointment)},a.addSpecial=function(){a.form.input.specialHours.push({date:"",startHour:"",endHour:""})},a.removeSpecial=function(b){var c=a.form.input.specialHours.length<=1;a.form.input.specialHours.splice(b,1),c&&a.addSpecial()},a.toggleDates=function(a){a?angular.element(".day.group.regular, .day.group.special").each(function(){angular.element(this).find("input, select, textarea").each(function(){angular.element(this).attr("disabled","disabled").addClass("disabled")})}):angular.element(".day.group.regular, .day.group.special").each(function(){angular.element(this).find("input, select, textarea").each(function(){angular.element(this).removeAttr("disabled").removeClass("disabled")})})},a.hasOneSpecialDate=function(){for(var b in a.form.input.specialHours)if(a.form.input.specialHours[b]&&a.form.input.specialHours[b].date&&a.form.input.specialHours[b].startHour&&a.form.input.specialHours[b].endHour)return!0;return!1},a.hasSpecial=function(){return a.hasOneSpecialDate()},a.$watch("hasSpecial()",function(b,c){b!==c&&a.toggleDates(b)}),a.artists={list:[],loaded:!1,deferred:m.defer(),load:function(){return a.artists.loaded?a.artists.deferred.promise:(f.get("artists/list").then(function(b){a.artists.list=b.data.data||[],a.artists.loaded=!0,a.artists.deferred.resolve(a.artists)}),a.artists.deferred.promise)},query:function(b){var c=m.defer();return b=b.toLowerCase(),a.artists.load().then(function(a){var d=[];a.list.forEach(function(a){a.name.full.toLowerCase().indexOf(b)>=0&&d.push(a)}),c.resolve(d)}),c.promise}},a.artists.load(),a.form={genreActive:function(a){return this.input.genres.indexOf(a)>=0},genres:l,loadArtists:function(a){return f.get("artists",{q:a,"return":"data"})},tagCounter:0,tagAdded:function(b){a.form.tagCounter++,b._id||(b._id=a.form.tagCounter,b.guest=!0)},loadVenues:function(a){return f.get("venues",{q:a,"return":"data"})},input:{genres:[],artists:[],venue:[],openingHours:[],specialHours:[]},dates:{start:a.today.clone().toDate(),end:a.today.clone().add(5,"days").toDate()},response:{},submit:function(){var b=this;if(_.size(a.photos)>0){var d=!1;if(angular.forEach(a.photos,function(a){0===_.size(a.nonUserArtists)&&(d=!0)}),d===!0)return this.response.message="Please select the artist/s for the photos",!1}b.input.photos=a.photos,this.response.message="",f.put("events/"+c.params.permalink,b.input).then(function(c){b.response=c.data,b.response.success&&(b.response.message="Event successfully updated",a.redirect=["exhibition",{permalink:c.data.data.permalink}])})}},a.confirmDelete=!1,a["delete"]=function(){f["delete"]("events/"+c.params.permalink).then(function(a){c.go("profile")})},a.loadExhibition();var u=h.find("tags-input:first");a.$watch(function(){return u.attr("class")},function(a,b){u.hasClass("ng-invalid")&&i.$broadcast("openPopup","venueDoesNotExist")}),a.focusVenue=function(){h.find("tags-input:first input:last").focus().select()};var v=h.find(".input.dates [date-range]:first");a.$on("setDate",function(a,b){if("object"==typeof a.targetScope.$parent.start&&"object"==typeof a.targetScope.$parent.end&&a.targetScope.date&&(a.targetScope.$$prevSibling||a.targetScope.$$nextSibling)&&!a.targetScope.$$prevSibling&&a.targetScope.$$nextSibling){var c=a.targetScope.date,d=a.targetScope.$$nextSibling.date,e=c.getMonth(),f=d.getMonth();e!==f&&(d.setYear(c.getFullYear()),d.setMonth(e))}}),j.put("templates/daterange.html",'<div class="date-range-wrap"><div class="date-picker-wrap"><h4>{{ \'Opening\' | lang }}</h4><div date-picker="start" ng-disabled="disableDatePickers" class="date-picker start" date after="start" before="end" min-view="date" max-view="date"></div></div><div class="date-picker-wrap"><h4>{{ \'Closing\' | lang }}</h4><div date-picker="end" ng-disabled="disableDatePickers" class="date-picker end" date after="start" before="end" min-view="date" max-view="date"></div></div></div>'),a.showDatepicker=function(){v.fadeIn(200)},a.hideDatepicker=function(){v.fadeOut(200),a.specialDateIndex=-1},a.$watchCollection("[form.dates.start, form.dates.end]",function(b,c){var d=g(a.form.dates.start),e=g(a.form.dates.end);a.form.input.dates=d.format("DD.MM.YYYY")+"-"+e.format("DD.MM.YYYY")}),a.addLink=function(){a.form.input.links.push({title:"",url:""})},a.removeLink=function(b){a.form.input.links.splice(b,1)},a.prefillEvent=function(){a.form.input.admissionFee=a.form.input.venue[0].admissionFee,a.form.input.openingHours=angular.copy(a.form.input.venue[0].openingHours)},h.on("keydown",'input.date, .input.dates:first input[name="dates"]',function(){return!1}),a.specialDateIndex=-1,a.specialDateFocused=function(b){a.specialDateIndex=b},a.singleDay=function(){return a.form.dates.start.toString()===a.form.dates.end.toString()},a.$watch("singleDay()",function(b,c){b!==c&&a.toggleDates(b)})}]),angular.module("main").controller("ArtistController",ArtistController),ArtistController.$inject=["$rootScope","$scope","$resource","$state","$timeout","API","Authentication","Upload","moment"],angular.module("main").controller("SearchController",SearchController),SearchController.$inject=["$rootScope","$element","$timeout","$scope","$resource","$state","$stateParams","Authentication","moment","API","location"],angular.module("main").controller("MapController",["$location","$scope","$state","API","MapOptions","uiGmapGoogleMapApi","$timeout","$window","$element","location","$q",function(a,b,c,d,e,f,g,h,i,j,k){b.venueTypes={gallery:"gallery",museum:"museum","public":"public space",other:"other"};var l=null,m=a.search().event||"",n=a.search().venue||"",o=m||n,p=function(a,b){a.Marker.prototype.setLabel=function(b){this.label=new c({map:this.map,marker:this,text:b,position:this.get("position")}),a.event.addListener(this,"position_changed",function(){this.label.set("position",this.get("position"))})};var c=function(a){this.setValues(a),this.element=document.createElement("span"),this.element.className=b};c.prototype=angular.element.extend(a.OverlayView.prototype,{onAdd:function(){this.getPanes().overlayImage.appendChild(this.element);var b=this;a.event.addListener(this,"position_changed",function(){b.draw()}),this.draw()},draw:function(){var a=String(this.get("text")),b=this.getProjection().fromLatLngToDivPixel(this.get("position")),c=angular.element(this.element);c.html(a).css({left:b.x-c.width()/2+"px",top:b.y+"px"})}})};b.close=function(){h.history.length?h.history.back():c.go("landing-now")},b.location={coordinates:null,set:function(a,c){b.location.coordinates={latitude:a,longitude:c}}};var q=[j.promise,f],r=k.defer();o&&q.push(r.promise),k.all(q).then(function(){var a=new b.map.maps.LatLng(j.current.latitude,j.current.longitude);b.location.set(j.current.latitude,j.current.longitude);var c=new b.map.maps.Marker({position:a,icon:h.location.origin+root+"/images/marker.png"});c.setMap(b.map.gmap),l&&(a=new b.map.maps.LatLng(l.venue.address.coordinates.latitude,l.venue.address.coordinates.longitude)),b.map.gmap.setCenter(a),b.directions.init()}),b.directions={display:null,service:null,init:function(){b.directions.display=new b.map.maps.DirectionsRenderer,b.directions.service=new b.map.maps.DirectionsService,b.directions.display.setMap(b.map.gmap)},request:function(a){return!!b.directions.service&&void b.directions.service.route({origin:new b.map.maps.LatLng(b.location.coordinates.latitude,b.location.coordinates.longitude),destination:new b.map.maps.LatLng(a.latitude,a.longitude),travelMode:b.map.maps.TravelMode.DRIVING},function(a,c){c===b.map.maps.DirectionsStatus.OK&&b.directions.display.setDirections(a)})}},b.preview={marker:null,element:angular.element(i).find(".preview:first"),photo:null,count:0,current:0,select:function(a){var c=b.preview.marker,d="";if(n){var e=b.preview.marker.venue;b.preview.focusVenue=!0,b.preview.venue=e,b.preview.description=e.description,d=e.name,e&&e.album&&e.album.photos&&e.album.photos[0]?b.preview.photo=e.album.photos[0]:b.preview.photo=null,b.preview.distance=function(){var a=b.preview.marker.distance();return a=a>=1?a.toFixed(2)+"km":Math.floor(1e3*a)+"m"}}else{var f=b.preview.marker.exhibitions[b.preview.current];b.preview.photo=f.gallery&&f.gallery.photos&&f.gallery.photos[0]?root+f.gallery.photos[0].photo.source:null,b.preview.name=f.name,b.preview.permalink=f.permalink;var g=[];for(var h in f.artists)f.artists[h]&&(f.artists[h].user&&f.artists[h].user.fullname?g.push(f.artists[h].user.fullname):f.artists[h].nonUser&&f.artists[h].nonUser.fullname&&g.push(f.artists[h].nonUser.fullname));b.preview.artists=g.join(", "),b.preview.venue=b.preview.marker.venue.name,b.preview.venuePermalink=b.preview.marker.venue.permalink,b.preview.distance=function(){var a=b.preview.marker.distance();return a=a>=1?a.toFixed(2)+"km":Math.floor(1e3*a)+"m"},b.preview.venueType=b.preview.marker.venue.venueType,b.preview.venueTypes=b.preview.marker.venue.venueTypes,b.preview.venueTypes.length||(b.preview.venueTypes=[b.preview.venueType]),b.preview.start=f.startDate,b.preview.end=f.endDate,b.preview.description=f.description,"open"===f.status&&"special"!==c.status&&(c.status="open"),"special"===f.status&&(c.status="special"),d=f.name}b.preview.element.addClass("show"),b.map.setMarkerStatus(c,!0),angular.element(c.label.element).removeClass("hide").text(d)},prev:function(){b.preview.current--,b.preview.current<0&&(b.preview.current=b.preview.count-1),b.preview.select()},next:function(){b.preview.current++,b.preview.current>=b.preview.count&&(b.preview.current=0),b.preview.select()},activeCoords:function(){return b.preview.marker.venue.address.coordinates},activeLatLng:function(){var a=b.preview.activeCoords();return new b.map.maps.LatLng(a.latitude,a.longitude)},locate:function(){b.map.gmap.panTo(b.preview.activeLatLng())},directions:function(){b.directions.request(b.preview.activeCoords())},set:function(a,c){if(b.preview.marker&&b.preview.marker.id===a.id)return!1;b.preview.marker=a;var d=b.preview.element.hasClass("show");b.preview.element.removeClass("show"),g(function(){if(b.preview.count=a.exhibitions.length,b.preview.current=0,c)for(var d in a.exhibitions)if(a.exhibitions[d].permalink===c){b.preview.current=d;break}b.preview.select()},d?200:1)}},b.map={maps:null,gmap:null,options:e,latitude:60.173324,longitude:24.941025,zoom:15,firstLoaded:!1,init:function(a,c){b.map.maps=a,b.map.gmap=c,p(a,"marker-label"),b.map.loaded(c)},loaded:function(a){if(!b.map.firstLoaded){b.map.populate();var c=b.map.gmap.getCenter();b.location.coordinates||b.location.set(c.lat(),c.lng())}b.map.firstLoaded=!0},change:function(a){},markers:[],userMarker:{},getMarkerById:function(a,c){c||(c=b.map.markers);for(var d in c)if(c[d].id===a)return c[d];return!1},setMarkerStatus:function(a,b){a.active=!!b,a.setIcon(h.location.origin+root+"/images/marker-"+a.status+(b?"-active":"")+".png")},clickMarker:function(){b.map.selectMarker(this)},selectMarker:function(a,c){for(var d in b.map.markers)b.map.markers[d].id!==a.id&&(b.map.setMarkerStatus(b.map.markers[d],!1),angular.element(b.map.markers[d].label.element).addClass("hide"));b.preview.set(a,c)},clearMarkers:function(){if(b.map.markers)for(var a in b.map.markers)b.map.markers[a].setMap(null);return b.map.markers=[],b.map},populating:null,populate:function(){b.map.populating&&g.cancel(b.map.populating),b.map.populating=g(function(){var a=(b.map.gmap.getBounds(),b.map.gmap.getCenter()),c=a.lat(),e=a.lng(),f="events",g={date:"today",limit:1e3};n&&(f="venues/"+n,g={}),d.get(f,g).then(function(a){b.map.clearMarkers();var d=[],f=!1,g=["gallery","museum","public","other"],i=null,k=null,o=null,p=0;if(n){if(a.data){for(i=a.data,o=new b.map.maps.LatLng(i.address.coordinates.latitude,i.address.coordinates.longitude),k=new b.map.maps.Marker({position:o,icon:h.location.origin+root+"/images/marker-closed.png",label:i.name}),p=i.venueTypes.length-1;p>=0;p--)g.indexOf(i.venueTypes[p])>=0&&i.venueTypes.splice(p,1);k.venue=i,k.id=i.id,k.exhibitions=[],k.active=!1,k.status=i.status,k.setIcon(h.location.origin+root+"/images/marker-"+i.status+".png"),k.distance=function(){return j.distance(this.venue.address.coordinates)},angular.element(k.label.element).addClass("hide"),d.push(k),k.addListener("click",b.map.clickMarker),l=k,f=!0}}else if(a.data.data)for(var q in a.data.data){var r=a.data.data[q];if(i=r.venue,k=b.map.getMarkerById(i.id,d),!k){for(o=new b.map.maps.LatLng(i.address.coordinates.latitude,i.address.coordinates.longitude),k=new b.map.maps.Marker({position:o,icon:h.location.origin+root+"/images/marker-closed.png",label:r.name}),p=i.venueTypes.length-1;p>=0;p--)g.indexOf(i.venueTypes[p])>=0&&i.venueTypes.splice(p,1);k.venue=i,k.id=i.id,k.exhibitions=[],k.active=!1,k.status="closed",k.distance=function(){return j.distance(this.venue.address.coordinates)},angular.element(k.label.element).addClass("hide"),d.push(k),k.addListener("click",b.map.clickMarker)}m?m===r.permalink&&(l=k,f=!0):n&&n===r.venue.permalink&&(l=k,f=!0),k.exhibitions.push(r),"open"===r.status&&"special"!==k.status&&(k.status="open",k.setIcon(h.location.origin+root+"/images/marker-open.png")),"special"===r.status&&(k.status="special",k.setIcon(h.location.origin+root+"/images/marker-special.png"))}d.sort(function(a,b){var d=j.distance({latitude:c,longitude:e},a.venue.address.coordinates),f=j.distance({latitude:c,longitude:e},b.venue.address.coordinates);return d-f});for(var s in d)b.map.dropMarker(d[s])})},1e3)},queuedMarkers:[],droppingMarker:!1,dropMarker:function(a){if(a&&(a.setMap(null),b.map.queuedMarkers.push(a)),!b.map.droppingMarker){var c=b.map.queuedMarkers[0];c?(b.map.droppingMarker=!0,c.setMap(b.map.gmap),c.label.setMap(b.map.gmap),c.setAnimation(b.map.maps.Animation.DROP),b.map.markers.push(c),b.map.queuedMarkers=b.map.queuedMarkers.slice(1),g(function(){b.map.droppingMarker=!1,b.map.dropMarker()},20)):l?(b.map.selectMarker(l,m),r.resolve(l)):b.map.selectMarker(b.map.markers[0])}}}}]),angular.module("main").constant("APP_KEYS",{cookieLangKey:"artAdvisor-userLang"}).config(mainConfig).run(initMain),mainConfig.$inject=["$stateProvider","$urlRouterProvider","uiGmapGoogleMapApiProvider","tagsInputConfigProvider"],initMain.$inject=["$rootScope","$window","$location","Authentication","$state","LangSvc","API","moment","amMoment"];