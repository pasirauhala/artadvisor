"use strict";function UsersController(a,b,c,d,e,f){a.authentication=d,a.users=[],a.count=0,a.getUsers=function(b,c,d,f){e.get("users",angular.extend({start:c,limit:d},b)).then(function(b){var c=b.data;a.users=c.data,a.count=c.count,f&&f(a.users,a.count)})},a.table=new c({page:1,count:10},{getData:function(b,c){var d=c.count(),e=c.filter(),f={};["name","username"].forEach(function(a){e&&e[a]&&(f[a]=e[a])}),a.getUsers(f,(c.page()-1)*d,d,function(c,d){a.table.total(d),b.resolve(c)})}}),a.isAdmin=function(a){return a.roles.indexOf("admin")>=0},a.updatingUser=!1,a.setUserRole=function(b,c){if(a.updatingUser)return!1;var d=b.roles.indexOf("admin");c?d<0&&b.roles.push("admin"):d>=0&&b.roles.splice(d,1),a.updatingUser=!0,e.put("users/"+b.username,{user:b}).then(function(b){a.updatingUser=!1})},a.isMe=function(a){return f.user_id===a._id},a["delete"]=function(b){return!!confirm('Are you sure you want delete "'+b.fullname+'"?\n\nPress OK to proceed')&&(a.updatingUser=!0,void e["delete"]("users/"+b.username).then(function(b){a.updatingUser=!1,a.table.reload(),a.$$phase||a.$apply()}))}}function ArtistsController(a,b,c,d,e,f){a.authentication=d;var g=b("/api/artists");a.artists=[],a.count=0,a.getArtists=function(b,c,d,e){g.get(angular.extend({start:c,limit:d},b),function(b){a.artists=b.data,a.count=b.count,e&&e(a.artists,a.count)})},a.table=new c({page:1,count:10},{getData:function(b,c){var d=c.count(),e=c.filter(),f={};["name","username"].forEach(function(a){e&&e[a]&&(f[a]=e[a])}),a.getArtists(f,(c.page()-1)*d,d,function(c,d){a.table.total(d),b.resolve(c)})}}),a.updatingArtist=!1,a.isMe=function(a){return e.user_id===a._id},a["delete"]=function(b){return!!confirm('Are you sure you want delete "'+b.fullname+'"?\n\nPress OK to proceed')&&(a.updatingArtist=!0,void f["delete"]("artists/"+b.username).then(function(b){a.updatingArtist=!1,a.table.reload(),a.$$phase||a.$apply()}))}}function VenuesController(a,b,c,d,e,f){var g=b("/api/venues");a.venues=[],a.count=0,a.getVenues=function(b,c,d,e){g.get(angular.extend(b,{start:c,limit:d}),function(b){a.venues=b.data,a.count=b.count,e&&e(a.venues,a.count)})},a.table=new c({page:1,count:10},{getData:function(b,c){var d=c.count(),e=c.filter(),f={};["name","address","owner"].forEach(function(a){e&&e[a]&&(f[a]=e[a])}),a.getVenues(f,(c.page()-1)*d,d,function(c,d){a.table.total(d),b.resolve(c)})}}),a.updatingVenue=!1,a.checkForActiveEvents=function(a){var b=e.defer();return f.get("venues/"+a.permalink).then(function(a){if(a.data&&a.data.exhibitions){var c=!1;for(var d in a.data.exhibitions)if(a.data.exhibitions[d].active){c=!0;break}c?b.reject():b.resolve(a.data)}}),b.promise},a["delete"]=function(b){a.checkForActiveEvents(b).then(function(){return!!confirm("Are you sure you want to delete this venue?\n\nPress OK to proceed")&&(a.updatingVenue=!0,void f["delete"]("venues/"+b.permalink).then(function(b){a.updatingVenue=!1,a.table.reload(),a.$$phase||a.$apply()}))})["catch"](function(){alert("Cannot delete venue. This is currently used in active events")})}}function ExhibitionsController(a,b,c,d,e){var f=c("/api/events");a.exhibitions=[],a.count=0,a.getExhibitions=function(b,c,d,e){f.get(angular.extend({start:c,limit:d},b),function(b){a.exhibitions=b.data,a.count=b.count,e&&e(a.exhibitions,a.count)})},a.table=new d({page:1,count:10},{getData:function(b,c){var d=c.count(),e=c.filter(),f={};["name","description","artist","venue"].forEach(function(a){e&&e[a]&&(f[a]=e[a])}),a.getExhibitions(f,(c.page()-1)*d,d,function(c,d){a.table.total(d),b.resolve(c)})}}),a.updatingExhibition=!1,a["delete"]=function(c){return!!confirm("Are you sure you want to delete this event?\n\nPress OK to proceed")&&(a.updatingExhibition=!0,void b["delete"]("events/"+c.permalink).then(function(b){a.updatingExhibition=!1,a.table.reload(),a.$$phase||a.$apply()}))}}var ApplicationConfiguration=function(){var a="mean",b=["ngResource","ngAnimate","ui.router","ui.bootstrap","ui.utils","ngTable","ngFileUpload","angularMoment"],c=function(b,c){angular.module(b,c||[]),angular.module(a).requires.push(b)};return{applicationModuleName:a,applicationModuleVendorDependencies:b,registerModule:c}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function(a){a.html5Mode(!0).hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("admin"),angular.module("admin").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/");var c=["dashboard","users","artists","venues","events","faker"];for(var d in c){var e=c[d];"events"===e&&(e="exhibitions"),a.state(c[d],{url:"/"+("dashboard"===c[d]?"":c[d]),templateUrl:root+"/modules/admin/views/"+e+".client.view.html"})}a.state("venue",{url:"/venues/:permalink",templateUrl:root+"/modules/admin/views/venue.client.view.html"})}]),angular.module("admin").service("API",["$http","$state","$q","Authentication","$window",function(a,b,c,d,e){var f=this;this.root="/api/";var g=function(a){return f.root+("/"===a.charAt(0)?a.substr(1):a)},h=function(a){return d.token&&(a.token=d.token),a},i=function(a){switch(a.group){case"general":alert(a.message);break;case"unauthorized":e.location="/authentication?next=/admin"}return a},j=function(a){var b=c.defer();return a.then(function(a){b.resolve(a)},function(a){a.data&&a.data.exception&&b.reject(i(a.data.exception))}),b.promise};this.get=function(b,c){return j(a.get(g(b),{params:h(c||{})}))},this.post=function(b,c,d){return j(a.post(g(b),c,{params:h(d||{})}))},this.put=function(b,c,d){return j(a.put(g(b),c,{params:h(d||{})}))},this["delete"]=function(b,c){return j(a["delete"](g(b),{params:h(c||{})}))}}]),angular.module("admin").factory("Authentication",["$window","$location",function(a,b){return a.token&&a.admin?{token:a.token}:(a.location="/authentication?next=/admin",{token:null})}]),angular.module("admin").controller("HeaderController",["$scope","$state","Authentication","API","$window",function(a,b,c,d,e){a.isCollapsed=!1,a.$state=b,a.toggleCollapsibleMenu=function(){a.isCollapsed=!a.isCollapsed},a.$on("$stateChangeSuccess",function(b,c,d,e,f){a.isCollapsed=!1,a.$state=c}),a.menu={active:function(b){if(a.$state.name===b)return!0;var c={venues:["venue"]};return c[b]&&c[b].indexOf(a.$state.name)>=0},name:function(a){return this.list[a].name},list:[{name:"dashboard",title:"Dashboard"},{name:"users",title:"Users"},{name:"artists",title:"Artists"},{name:"venues",title:"Venues"},{name:"events",title:"Events"},{name:"faker",title:"Faker"},{name:"logout",title:"Logout",action:function(){a.logout()},link:!0}]},a.logout=function(){d["delete"]("authenticate/logout").then(function(a){c.token=null,e.location="/authentication"})}}]),angular.module("admin").controller("DashboardController",["$scope","Authentication","API",function(a,b,c){a.authentication=b,a.user={},c.get("me").then(function(b){a.user=b.data}),a.summary={},c.get("summary").then(function(b){a.summary=b.data})}]),angular.module("admin").controller("UsersController",UsersController),UsersController.$inject=["$scope","$resource","NgTableParams","Authentication","API","$window"],angular.module("admin").controller("ArtistsController",ArtistsController),ArtistsController.$inject=["$scope","$resource","NgTableParams","Authentication","$window","API"],angular.module("admin").controller("VenuesController",VenuesController),VenuesController.$inject=["$scope","$resource","NgTableParams","Authentication","$q","API"],angular.module("admin").controller("VenueController",["$scope","$resource","$state","Upload","Authentication",function(a,b,c,d,e){var f=b("/api/venues/:permalink",{permalink:c.params.permalink});a.venue={},a.loadVenue=function(b){f.get(null,function(c){a.venue=c,b&&b(a.venue)})},a.uploadCount=0,a.upload=function(b){var c=angular.element;if(b&&b.length)for(var e=c(".page.venue:first .file:first"),f=0;f<b.length;f++){var g=b[f];a.uploadCount++;var h=c("<div>").addClass("uploading").attr("id","uploading-"+a.uploadCount).append(c("<div>").addClass("filename").text("Uploading "+g.name)).append(c("<div>").addClass("progress").append(c("<div>").addClass("percent")));e.append(h),g.uploadId=a.uploadCount,d.upload({url:"/api/upload",fields:{},file:g}).progress(function(a){var b=a.loaded/a.total*100,d=c("#uploading-"+a.config.file.uploadId);d.find(".progress:first .percent:first").css({width:b+"%"})}).success(function(a,b,d,e){var f=c("#uploading-"+e.file.uploadId);f.stop().fadeOut(200,function(){this.remove()})}),e.find(".uploading:last").show(200)}},a.loadVenue()}]),angular.module("admin").controller("ExhibitionsController",ExhibitionsController),ExhibitionsController.$inject=["$scope","API","$resource","NgTableParams","Authentication"],angular.module("admin").controller("FakerController",["$scope","$http","Authentication","API",function(a,b,c,d){a.models=["artist","venue","exhibition","album","photo","gallery","token","search","comment","setting"],a.getModelName=function(a){return"exhibition"===a?"Event":a.substr(0,1).toUpperCase()+a.substr(1)},a.truncate={data:{model:"artist"},submit:function(){confirm("Are you sure you want to empty "+this.data.model+"?")&&d.post("faker/truncate/"+this.data.model,{}).then(function(a){alert(a.data.message||"Truncate failed")})}},a.generate={data:{model:"artist",amount:1},submit:function(){d.post("faker/generate/"+this.data.model,{amount:this.data.amount}).then(function(a){alert(a.data.message||"Truncate failed")})}}}]);